<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ZooKeeper Java Api | BIGDATA-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/bigdata-tutorial/favicon.ico">
    <meta name="description" content="å¤§æ•°æ®æ•™ç¨‹">
    
    <link rel="preload" href="/bigdata-tutorial/assets/css/0.styles.eecf7a64.css" as="style"><link rel="preload" href="/bigdata-tutorial/assets/js/app.3ada26ba.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/4.cda5e0f1.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/56.ffb4a04b.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/5.9d6e4fe2.js" as="script"><link rel="prefetch" href="/bigdata-tutorial/assets/js/10.1ab7bd74.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/11.a42f7604.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/12.7dce2ed8.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/13.1b26207d.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/14.a9835374.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/15.90c66596.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/16.e0471453.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/17.2c0565cb.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/18.fabbce00.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/19.c120a108.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/20.5a4f48af.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/21.d3fce730.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/22.00ac574a.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/23.754595c9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/24.fc9d31a1.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/25.d4313bcb.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/26.604f045b.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/27.22a239b2.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/28.466b9a71.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/29.2783ebfd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/30.2ff3250e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/31.2c64e404.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/32.0ab8b31c.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/33.be38d2dc.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/34.811f6626.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/35.9d9f3847.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/36.32bb3f84.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/37.db182f29.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/38.91a9d6f3.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/39.1148f971.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/40.1536c75c.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/41.31725066.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/42.68e59bdd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/43.9bac72d5.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/44.a2edd3e0.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/45.4a1cf2ae.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/46.d8a80a79.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/47.9621b1a5.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/48.56d4fa14.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/49.d9d143dd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/50.6e4aa6cd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/51.55771fda.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/52.ee51188b.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/53.b014e486.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/54.ae66c176.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/55.2ea9bfd9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/57.bdee2f7e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/58.982c2219.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/59.c006237e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/6.3bb0b816.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/60.b27dc3c8.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/7.d55602d2.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/8.89e9ace9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/9.0c40eb95.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/vendors~flowchart.5998caa6.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/vendors~notification.943e54fe.js">
    <link rel="stylesheet" href="/bigdata-tutorial/assets/css/0.styles.eecf7a64.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bigdata-tutorial/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo-200.png" alt="BIGDATA-TUTORIAL" class="logo"> <span class="site-name can-hide">BIGDATA-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bigdata-tutorial/hive/" class="nav-link">
  Hive
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hdfs/" class="nav-link">
  Hdfs
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hbase/" class="nav-link">
  Hbase
</a></div><div class="nav-item"><a href="/bigdata-tutorial/zookeeper/" class="nav-link router-link-active">
  ZooKeeper
</a></div><div class="nav-item"><a href="/bigdata-tutorial/kafka/" class="nav-link">
  Kafka
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/bigdata-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bigdata-tutorial/hive/" class="nav-link">
  Hive
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hdfs/" class="nav-link">
  Hdfs
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hbase/" class="nav-link">
  Hbase
</a></div><div class="nav-item"><a href="/bigdata-tutorial/zookeeper/" class="nav-link router-link-active">
  ZooKeeper
</a></div><div class="nav-item"><a href="/bigdata-tutorial/kafka/" class="nav-link">
  Kafka
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/bigdata-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ZooKeeper Java Api</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_1-zookeeper-å®˜æ–¹å®¢æˆ·ç«¯" class="sidebar-link">1. ZooKeeper å®˜æ–¹å®¢æˆ·ç«¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_1-1-zookeeper-å®¢æˆ·ç«¯ç®€ä»‹" class="sidebar-link">1.1. ZooKeeper å®¢æˆ·ç«¯ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_1-2-åˆ›å»ºè¿æ¥" class="sidebar-link">1.2. åˆ›å»ºè¿æ¥</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_1-3-èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥" class="sidebar-link">1.3. èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥</a></li></ul></li><li><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_2-curator-å®¢æˆ·ç«¯" class="sidebar-link">2. Curator å®¢æˆ·ç«¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_2-1-curator-å®¢æˆ·ç«¯ç®€ä»‹" class="sidebar-link">2.1. Curator å®¢æˆ·ç«¯ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_2-2-åˆ›å»ºè¿æ¥" class="sidebar-link">2.2. åˆ›å»ºè¿æ¥</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_2-3-èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥" class="sidebar-link">2.3. èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_2-4-ç›‘å¬äº‹ä»¶" class="sidebar-link">2.4. ç›‘å¬äº‹ä»¶</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_2-5-acl-æƒé™ç®¡ç†" class="sidebar-link">2.5. ACL æƒé™ç®¡ç†</a></li></ul></li><li><a href="/bigdata-tutorial/zookeeper/ZooKeeperJavaApi.html#_3-å‚è€ƒèµ„æ–™" class="sidebar-link">3. å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="zookeeper-java-api"><a href="#zookeeper-java-api" class="header-anchor">#</a> ZooKeeper Java Api</h1> <blockquote><p>ZooKeeper æ˜¯ Apache çš„é¡¶çº§é¡¹ç›®ã€‚<strong>ZooKeeper ä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›äº†é«˜æ•ˆä¸”å¯é çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œæä¾›äº†è¯¸å¦‚ç»Ÿä¸€å‘½åæœåŠ¡ã€é…ç½®ç®¡ç†å’Œåˆ†å¸ƒå¼é”ç­‰åˆ†å¸ƒå¼çš„åŸºç¡€æœåŠ¡ã€‚åœ¨è§£å†³åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§æ–¹é¢ï¼ŒZooKeeper å¹¶æ²¡æœ‰ç›´æ¥é‡‡ç”¨ Paxos ç®—æ³•ï¼Œè€Œæ˜¯é‡‡ç”¨äº†åä¸º ZAB çš„ä¸€è‡´æ€§åè®®</strong>ã€‚</p> <p>ZooKeeper ä¸»è¦ç”¨æ¥è§£å†³åˆ†å¸ƒå¼é›†ç¾¤ä¸­åº”ç”¨ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå®ƒèƒ½æä¾›åŸºäºç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•èŠ‚ç‚¹æ ‘æ–¹å¼çš„æ•°æ®å­˜å‚¨ã€‚ä½†æ˜¯ ZooKeeper å¹¶ä¸æ˜¯ç”¨æ¥ä¸“é—¨å­˜å‚¨æ•°æ®çš„ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦æ˜¯ç”¨æ¥<strong>ç»´æŠ¤å’Œç›‘æ§å­˜å‚¨æ•°æ®çš„çŠ¶æ€å˜åŒ–ã€‚é€šè¿‡ç›‘æ§è¿™äº›æ•°æ®çŠ¶æ€çš„å˜åŒ–ï¼Œä»è€Œå¯ä»¥è¾¾åˆ°åŸºäºæ•°æ®çš„é›†ç¾¤ç®¡ç†</strong>ã€‚</p> <p>å¾ˆå¤šå¤§åé¼é¼çš„æ¡†æ¶éƒ½åŸºäº ZooKeeper æ¥å®ç°åˆ†å¸ƒå¼é«˜å¯ç”¨ï¼Œå¦‚ï¼šDubboã€Kafka ç­‰ã€‚</p> <p>ZooKeeper å®˜æ–¹æ”¯æŒ Java å’Œ C çš„ Client APIã€‚ZooKeeper ç¤¾åŒºä¸ºå¤§å¤šæ•°è¯­è¨€ï¼ˆ.NETï¼Œpython ç­‰ï¼‰æä¾›éå®˜æ–¹ APIã€‚</p></blockquote> <ul><li><a href="#1-zookeeper-%E5%AE%98%E6%96%B9%E5%AE%A2%E6%88%B7%E7%AB%AF">1. ZooKeeper å®˜æ–¹å®¢æˆ·ç«¯</a> <ul><li><a href="#11-zookeeper-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%AE%80%E4%BB%8B">1.1. ZooKeeper å®¢æˆ·ç«¯ç®€ä»‹</a></li> <li><a href="#12-%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5">1.2. åˆ›å»ºè¿æ¥</a></li> <li><a href="#13-%E8%8A%82%E7%82%B9%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5">1.3. èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥</a> <ul><li><a href="#131-%E5%88%A4%E6%96%AD%E8%8A%82%E7%82%B9%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">1.3.1. åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</a></li> <li><a href="#132-%E5%88%9B%E5%BB%BA%E8%8A%82%E7%82%B9">1.3.2. åˆ›å»ºèŠ‚ç‚¹</a></li> <li><a href="#133-%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9">1.3.3. åˆ é™¤èŠ‚ç‚¹</a></li> <li><a href="#134-%E8%8E%B7%E5%8F%96%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE">1.3.4. è·å–èŠ‚ç‚¹æ•°æ®</a></li> <li><a href="#135-%E8%AE%BE%E7%BD%AE%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE">1.3.5. è®¾ç½®èŠ‚ç‚¹æ•°æ®</a></li> <li><a href="#136-%E8%8E%B7%E5%8F%96%E5%AD%90%E8%8A%82%E7%82%B9">1.3.6. è·å–å­èŠ‚ç‚¹</a></li></ul></li></ul></li> <li><a href="#2-curator-%E5%AE%A2%E6%88%B7%E7%AB%AF">2. Curator å®¢æˆ·ç«¯</a> <ul><li><a href="#21-curator-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%AE%80%E4%BB%8B">2.1. Curator å®¢æˆ·ç«¯ç®€ä»‹</a></li> <li><a href="#22-%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5">2.2. åˆ›å»ºè¿æ¥</a></li> <li><a href="#23-%E8%8A%82%E7%82%B9%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5">2.3. èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥</a> <ul><li><a href="#231-%E5%88%A4%E6%96%AD%E8%8A%82%E7%82%B9%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">2.3.1. åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</a></li> <li><a href="#232-%E5%88%A4%E8%AF%BB%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81">2.3.2. åˆ¤è¯»æœåŠ¡çŠ¶æ€</a></li> <li><a href="#233-%E5%88%9B%E5%BB%BA%E8%8A%82%E7%82%B9">2.3.3. åˆ›å»ºèŠ‚ç‚¹</a></li> <li><a href="#234-%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9">2.3.4. åˆ é™¤èŠ‚ç‚¹</a></li> <li><a href="#235-%E8%8E%B7%E5%8F%96%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE">2.3.5. è·å–èŠ‚ç‚¹æ•°æ®</a></li> <li><a href="#236-%E8%AE%BE%E7%BD%AE%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE">2.3.6. è®¾ç½®èŠ‚ç‚¹æ•°æ®</a></li> <li><a href="#237-%E8%8E%B7%E5%8F%96%E5%AD%90%E8%8A%82%E7%82%B9">2.3.7. è·å–å­èŠ‚ç‚¹</a></li></ul></li> <li><a href="#24-%E7%9B%91%E5%90%AC%E4%BA%8B%E4%BB%B6">2.4. ç›‘å¬äº‹ä»¶</a> <ul><li><a href="#241-%E5%88%9B%E5%BB%BA%E4%B8%80%E6%AC%A1%E6%80%A7%E7%9B%91%E5%90%AC">2.4.1. åˆ›å»ºä¸€æ¬¡æ€§ç›‘å¬</a></li> <li><a href="#242-%E5%88%9B%E5%BB%BA%E6%B0%B8%E4%B9%85%E7%9B%91%E5%90%AC">2.4.2. åˆ›å»ºæ°¸ä¹…ç›‘å¬</a></li> <li><a href="#243-%E7%9B%91%E5%90%AC%E5%AD%90%E8%8A%82%E7%82%B9">2.4.3. ç›‘å¬å­èŠ‚ç‚¹</a></li></ul></li> <li><a href="#25-acl-%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86">2.5. ACL æƒé™ç®¡ç†</a></li></ul></li> <li><a href="#3-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">3. å‚è€ƒèµ„æ–™</a></li></ul> <h2 id="_1-zookeeper-å®˜æ–¹å®¢æˆ·ç«¯"><a href="#_1-zookeeper-å®˜æ–¹å®¢æˆ·ç«¯" class="header-anchor">#</a> 1. ZooKeeper å®˜æ–¹å®¢æˆ·ç«¯</h2> <h3 id="_1-1-zookeeper-å®¢æˆ·ç«¯ç®€ä»‹"><a href="#_1-1-zookeeper-å®¢æˆ·ç«¯ç®€ä»‹" class="header-anchor">#</a> 1.1. ZooKeeper å®¢æˆ·ç«¯ç®€ä»‹</h3> <p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤äº’éµå¾ªä»¥ä¸‹åŸºæœ¬æ­¥éª¤ï¼š</p> <ol><li>å®¢æˆ·ç«¯è¿æ¥ ZooKeeper æœåŠ¡ç«¯é›†ç¾¤ä»»æ„å·¥ä½œèŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¸ºå®¢æˆ·ç«¯åˆ†é…ä¼šè¯ IDã€‚</li> <li>ä¸ºäº†ä¿æŒé€šä¿¡ï¼Œå®¢æˆ·ç«¯éœ€è¦å’ŒæœåŠ¡ç«¯ä¿æŒå¿ƒè·³ï¼ˆå®è´¨ä¸Šå°±æ˜¯ ping ï¼‰ã€‚å¦åˆ™ï¼ŒZooKeeper æœåŠ¡ä¼šè¯è¶…æ—¶æ—¶é—´å†…æœªæ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ï¼Œä¼šå°†ä¼šè¯è§†ä¸ºè¿‡æœŸã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¦‚æœè¦é€šä¿¡ï¼Œå°±éœ€è¦é‡æ–°è¿æ¥ã€‚</li> <li>åªè¦ä¼šè¯ ID å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå°±å¯ä»¥æ‰§è¡Œè¯»å†™ znode æ“ä½œã€‚</li> <li>æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®¢æˆ·ç«¯æ–­å¼€ä¸ ZooKeeper æœåŠ¡ç«¯é›†ç¾¤çš„è¿æ¥ã€‚å¦‚æœå®¢æˆ·ç«¯é•¿æ—¶é—´ä¸æ´»åŠ¨ï¼Œåˆ™ ZooKeeper é›†åˆå°†è‡ªåŠ¨æ–­å¼€å®¢æˆ·ç«¯ã€‚</li></ol> <p>ZooKeeper å®˜æ–¹å®¢æˆ·ç«¯çš„æ ¸å¿ƒæ˜¯ <strong><code>ZooKeeper</code> ç±»</strong>ã€‚å®ƒåœ¨å…¶æ„é€ å‡½æ•°ä¸­æä¾›äº†è¿æ¥ ZooKeeper æœåŠ¡çš„é…ç½®é€‰é¡¹ï¼Œå¹¶æä¾›äº†è®¿é—® ZooKeeper æ•°æ®çš„æ–¹æ³•ã€‚</p> <blockquote><p>å…¶ä¸»è¦æ“ä½œå¦‚ä¸‹ï¼š</p> <ul><li><strong><code>connect</code></strong> - è¿æ¥ ZooKeeper æœåŠ¡</li> <li><strong><code>create</code></strong> - åˆ›å»º znode</li> <li><strong><code>exists</code></strong> - æ£€æŸ¥ znode æ˜¯å¦å­˜åœ¨åŠå…¶ä¿¡æ¯</li> <li><strong><code>getACL</code></strong> / <strong><code>setACL</code></strong>- è·å–/è®¾ç½®ä¸€ä¸ª znode çš„ ACL</li> <li><strong><code>getData</code></strong> / <strong><code>setData</code></strong>- è·å–/è®¾ç½®ä¸€ä¸ª znode çš„æ•°æ®</li> <li><strong><code>getChildren</code></strong> - è·å–ç‰¹å®š znode ä¸­çš„æ‰€æœ‰å­èŠ‚ç‚¹</li> <li><strong><code>delete</code></strong> - åˆ é™¤ç‰¹å®šçš„ znode åŠå…¶æ‰€æœ‰å­é¡¹</li> <li><strong><code>close</code></strong> - å…³é—­è¿æ¥</li></ul></blockquote> <p>ZooKeeper å®˜æ–¹å®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹æ³•æ˜¯åœ¨ maven é¡¹ç›®çš„ pom.xml ä¸­æ·»åŠ ï¼š</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_1-2-åˆ›å»ºè¿æ¥"><a href="#_1-2-åˆ›å»ºè¿æ¥" class="header-anchor">#</a> 1.2. åˆ›å»ºè¿æ¥</h3> <p>ZooKeeper ç±»é€šè¿‡å…¶æ„é€ å‡½æ•°æä¾›è¿æ¥ ZooKeeper æœåŠ¡çš„åŠŸèƒ½ã€‚å…¶æ„é€ å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token class-name">String</span> connectionString<span class="token punctuation">,</span> <span class="token keyword">int</span> sessionTimeout<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>å‚æ•°è¯´æ˜ï¼š</p> <ul><li><strong><code>connectionString</code></strong> - ZooKeeper é›†ç¾¤çš„ä¸»æœºåˆ—è¡¨ã€‚</li> <li><strong><code>sessionTimeout</code></strong> - ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚</li> <li><strong>watcher</strong> - å®ç°ç›‘è§†æœºåˆ¶çš„å›è°ƒã€‚å½“è¢«ç›‘æ§çš„ znode çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒZooKeeper æœåŠ¡ç«¯çš„ <code>WatcherManager</code> ä¼šä¸»åŠ¨è°ƒç”¨ä¼ å…¥çš„ Watcher ï¼Œæ¨é€çŠ¶æ€å˜åŒ–ç»™å®¢æˆ·ç«¯ã€‚</li></ul></blockquote> <p>ã€ç¤ºä¾‹ã€‘è¿æ¥ ZooKeeper</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span></span><span class="token class-name">Watcher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span></span><span class="token class-name">ZooKeeper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * ZooKeeper å®˜æ–¹å®¢æˆ·ç«¯æµ‹è¯•ä¾‹
 *
 * @author &lt;a href=&quot;mailto:forbreak@163.com&quot;&gt;Zhang Peng&lt;/a&gt;
 * @since 2022-02-19
 */</span>
<span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;ZooKeeper å®˜æ–¹å®¢æˆ·ç«¯æµ‹è¯•ä¾‹&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZooKeeperTest</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * ZooKeeper è¿æ¥å®ä¾‹
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeper</span> zk<span class="token punctuation">;</span>

    <span class="token comment">/**
     * åˆ›å»º ZooKeeper è¿æ¥
     */</span>
    <span class="token annotation punctuation">@BeforeAll</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> HOST <span class="token operator">=</span> <span class="token string">&quot;localhost:2181&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> watcher <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Watcher<span class="token punctuation">.</span>Event<span class="token punctuation">.</span>KeeperState<span class="token punctuation">.</span>SyncConnected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å…³é—­ ZooKeeper è¿æ¥
     */</span>
    <span class="token annotation punctuation">@AfterAll</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>zk <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            zk<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å»ºç«‹è¿æ¥
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ZooKeeper<span class="token punctuation">.</span>States</span> state <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>è¯´æ˜ï¼š</p> <p>æ·»åŠ ä¸€ä¸ª <code>connect</code> æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ª <code>ZooKeeper</code> å¯¹è±¡ï¼Œç”¨äºè¿æ¥åˆ° ZooKeeper æœåŠ¡ã€‚</p> <p>è¿™é‡Œ <code>CountDownLatch</code> ç”¨äºåœæ­¢ï¼ˆç­‰å¾…ï¼‰ä¸»è¿›ç¨‹ï¼Œç›´åˆ°å®¢æˆ·ç«¯ä¸ ZooKeeper é›†åˆè¿æ¥ã€‚</p> <p><code>ZooKeeper</code> å¯¹è±¡é€šè¿‡ç›‘å¬å™¨å›è°ƒæ¥ç›‘å¬è¿æ¥çŠ¶æ€ã€‚ä¸€æ—¦å®¢æˆ·ç«¯ä¸ ZooKeeper å»ºç«‹è¿æ¥ï¼Œç›‘å¬å™¨å›è°ƒå°±ä¼šè¢«è°ƒç”¨ï¼›å¹¶ä¸”ç›‘å¬å™¨å›è°ƒå‡½æ•°è°ƒç”¨ <code>CountDownLatch</code> çš„ <code>countDown</code> æ–¹æ³•æ¥é‡Šæ”¾é”ï¼Œåœ¨ä¸»è¿›ç¨‹ä¸­ <code>await</code>ã€‚</p></blockquote> <h3 id="_1-3-èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥"><a href="#_1-3-èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥" class="header-anchor">#</a> 1.3. èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥</h3> <h4 id="_1-3-1-åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"><a href="#_1-3-1-åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨" class="header-anchor">#</a> 1.3.1. åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</h4> <p>ZooKeeper ç±»æä¾›äº† <code>exists</code> æ–¹æ³•æ¥æ£€æŸ¥ znode çš„å­˜åœ¨ã€‚å¦‚æœæŒ‡å®šçš„ znode å­˜åœ¨ï¼Œåˆ™è¿”å›ä¸€ä¸ª znode çš„å…ƒæ•°æ®ã€‚</p> <p><code>exists</code> æ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>exists(String path, boolean watcher)
</code></pre></div><ul><li><strong>path</strong>- Znode è·¯å¾„</li> <li><strong>watcher</strong> - å¸ƒå°”å€¼ï¼Œç”¨äºæŒ‡å®šæ˜¯å¦ç›‘è§†æŒ‡å®šçš„ znode</li></ul> <p>ã€ç¤ºä¾‹ã€‘</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Stat</span> stat <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>stat<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-3-2-åˆ›å»ºèŠ‚ç‚¹"><a href="#_1-3-2-åˆ›å»ºèŠ‚ç‚¹" class="header-anchor">#</a> 1.3.2. åˆ›å»ºèŠ‚ç‚¹</h4> <p><code>ZooKeeper</code> ç±»çš„ <code>create</code> æ–¹æ³•ç”¨äºåœ¨ ZooKeeper ä¸­åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼ˆznodeï¼‰ã€‚</p> <p><code>create</code> æ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>create(String path, byte[] data, List&lt;ACL&gt; acl, CreateMode createMode)
</code></pre></div><ul><li><strong>path</strong> - Znode è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ/myapp1ï¼Œ/myapp2ï¼Œ/myapp1/mydata1ï¼Œmyapp2/mydata1/myanothersubdata</li> <li><strong>data</strong> - è¦å­˜å‚¨åœ¨æŒ‡å®š znode è·¯å¾„ä¸­çš„æ•°æ®</li> <li><strong>acl</strong> - è¦åˆ›å»ºçš„èŠ‚ç‚¹çš„è®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚ZooKeeper API æä¾›äº†ä¸€ä¸ªé™æ€æ¥å£ <strong>ZooDefs.Ids</strong> æ¥è·å–ä¸€äº›åŸºæœ¬çš„ acl åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼ŒZooDefs.Ids.OPEN_ACL_UNSAFE è¿”å›æ‰“å¼€ znode çš„ acl åˆ—è¡¨ã€‚</li> <li><strong>createMode</strong> - èŠ‚ç‚¹çš„ç±»å‹ï¼Œå³ä¸´æ—¶ï¼Œé¡ºåºæˆ–ä¸¤è€…ã€‚è¿™æ˜¯ä¸€ä¸ª<strong>æšä¸¾</strong>ã€‚</li></ul> <p>ã€ç¤ºä¾‹ã€‘</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/mytest&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">&quot;My first zookeeper app&quot;</span><span class="token punctuation">;</span>
zk<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Stat</span> stat <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>stat<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-3-3-åˆ é™¤èŠ‚ç‚¹"><a href="#_1-3-3-åˆ é™¤èŠ‚ç‚¹" class="header-anchor">#</a> 1.3.3. åˆ é™¤èŠ‚ç‚¹</h4> <p>ZooKeeper ç±»æä¾›äº† <code>delete</code> æ–¹æ³•æ¥åˆ é™¤æŒ‡å®šçš„ znodeã€‚</p> <p><code>delete</code> æ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>delete(String path, int version)
</code></pre></div><ul><li><strong>path</strong> - Znode è·¯å¾„ã€‚</li> <li><strong>version</strong> - znode çš„å½“å‰ç‰ˆæœ¬ã€‚</li></ul> <p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ Java åº”ç”¨ç¨‹åºæ¥äº†è§£ ZooKeeper API çš„ <strong>delete</strong> åŠŸèƒ½ã€‚åˆ›å»ºæ–‡ä»¶ <strong>ZKDelete.java</strong> ã€‚åœ¨ main æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ <strong>ZooKeeperConnection</strong> å¯¹è±¡åˆ›å»ºä¸€ä¸ª ZooKeeper å¯¹è±¡ <strong>zk</strong> ã€‚ç„¶åï¼Œä½¿ç”¨æŒ‡å®šçš„è·¯å¾„å’Œç‰ˆæœ¬å·è°ƒç”¨ <strong>zk</strong> å¯¹è±¡çš„ <strong>delete</strong> æ–¹æ³•ã€‚</p> <p>åˆ é™¤ znode çš„å®Œæ•´ç¨‹åºä»£ç å¦‚ä¸‹ï¼š</p> <p>ã€ç¤ºä¾‹ã€‘</p> <div class="language-java extra-class"><pre class="language-java"><code>zk<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Stat</span> stat <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNull</span><span class="token punctuation">(</span>stat<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-3-4-è·å–èŠ‚ç‚¹æ•°æ®"><a href="#_1-3-4-è·å–èŠ‚ç‚¹æ•°æ®" class="header-anchor">#</a> 1.3.4. è·å–èŠ‚ç‚¹æ•°æ®</h4> <p>ZooKeeper ç±»æä¾› <strong>getData</strong> æ–¹æ³•æ¥è·å–é™„åŠ åœ¨æŒ‡å®š znode ä¸­çš„æ•°æ®åŠå…¶çŠ¶æ€ã€‚ <strong>getData</strong> æ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>getData(String path, Watcher watcher, Stat stat)
</code></pre></div><ul><li><strong>path</strong> - Znode è·¯å¾„ã€‚</li> <li><strong>watcher</strong> - ç›‘å¬å™¨ç±»å‹çš„å›è°ƒå‡½æ•°ã€‚å½“æŒ‡å®šçš„ znode çš„æ•°æ®æ”¹å˜æ—¶ï¼ŒZooKeeper é›†åˆå°†é€šè¿‡ç›‘å¬å™¨å›è°ƒè¿›è¡Œé€šçŸ¥ã€‚è¿™æ˜¯ä¸€æ¬¡æ€§é€šçŸ¥ã€‚</li> <li><strong>stat</strong> - è¿”å› znode çš„å…ƒæ•°æ®ã€‚</li></ul> <p>ã€ç¤ºä¾‹ã€‘</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> text1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> text1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>text1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-3-5-è®¾ç½®èŠ‚ç‚¹æ•°æ®"><a href="#_1-3-5-è®¾ç½®èŠ‚ç‚¹æ•°æ®" class="header-anchor">#</a> 1.3.5. è®¾ç½®èŠ‚ç‚¹æ•°æ®</h4> <p>ZooKeeper ç±»æä¾› <strong>setData</strong> æ–¹æ³•æ¥ä¿®æ”¹æŒ‡å®š znode ä¸­é™„åŠ çš„æ•°æ®ã€‚ <strong>setData</strong> æ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>setData(String path, byte[] data, int version)
</code></pre></div><ul><li><strong>path</strong>- Znode è·¯å¾„</li> <li><strong>data</strong> - è¦å­˜å‚¨åœ¨æŒ‡å®š znode è·¯å¾„ä¸­çš„æ•°æ®ã€‚</li> <li><strong>version</strong>- znode çš„å½“å‰ç‰ˆæœ¬ã€‚æ¯å½“æ•°æ®æ›´æ”¹æ—¶ï¼ŒZooKeeper ä¼šæ›´æ–° znode çš„ç‰ˆæœ¬å·ã€‚</li></ul> <p>ã€ç¤ºä¾‹ã€‘</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">&quot;å«å­èŠ‚ç‚¹çš„èŠ‚ç‚¹&quot;</span><span class="token punctuation">;</span>
zk<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
zk<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">&quot;/1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
zk<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">&quot;/2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> actualList <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> child <span class="token operator">:</span> actualList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_1-3-6-è·å–å­èŠ‚ç‚¹"><a href="#_1-3-6-è·å–å­èŠ‚ç‚¹" class="header-anchor">#</a> 1.3.6. è·å–å­èŠ‚ç‚¹</h4> <p>ZooKeeper ç±»æä¾› <strong>getChildren</strong> æ–¹æ³•æ¥è·å–ç‰¹å®š znode çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚ <strong>getChildren</strong> æ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>getChildren(String path, Watcher watcher)
</code></pre></div><ul><li><strong>path</strong> - Znode è·¯å¾„ã€‚</li> <li><strong>watcher</strong> - ç›‘å¬å™¨ç±»å‹çš„å›è°ƒå‡½æ•°ã€‚å½“æŒ‡å®šçš„ znode è¢«åˆ é™¤æˆ– znode ä¸‹çš„å­èŠ‚ç‚¹è¢«åˆ›å»º/åˆ é™¤æ—¶ï¼ŒZooKeeper é›†åˆå°†è¿›è¡Œé€šçŸ¥ã€‚è¿™æ˜¯ä¸€æ¬¡æ€§é€šçŸ¥ã€‚</li></ul> <p>ã€ç¤ºä¾‹ã€‘</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">KeeperException</span> <span class="token punctuation">{</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token string">&quot;My first zookeeper app&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    zk<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    zk<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">&quot;/1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    zk<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">&quot;/2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> actualList <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> expectedList <span class="token operator">=</span> <span class="token class-name">CollectionUtil</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">CollectionUtil</span><span class="token punctuation">.</span><span class="token function">containsAll</span><span class="token punctuation">(</span>expectedList<span class="token punctuation">,</span> actualList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> child <span class="token operator">:</span> actualList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-curator-å®¢æˆ·ç«¯"><a href="#_2-curator-å®¢æˆ·ç«¯" class="header-anchor">#</a> 2. Curator å®¢æˆ·ç«¯</h2> <h3 id="_2-1-curator-å®¢æˆ·ç«¯ç®€ä»‹"><a href="#_2-1-curator-å®¢æˆ·ç«¯ç®€ä»‹" class="header-anchor">#</a> 2.1. Curator å®¢æˆ·ç«¯ç®€ä»‹</h3> <p>Curator å®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹æ³•æ˜¯åœ¨ maven é¡¹ç›®çš„ pom.xml ä¸­æ·»åŠ ï¼š</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.curator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>curator-recipes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-2-åˆ›å»ºè¿æ¥"><a href="#_2-2-åˆ›å»ºè¿æ¥" class="header-anchor">#</a> 2.2. åˆ›å»ºè¿æ¥</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>curator<span class="token punctuation">.</span></span><span class="token class-name">RetryPolicy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>curator<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span><span class="token class-name">CuratorFramework</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>curator<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span><span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>curator<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>imps<span class="token punctuation">.</span></span><span class="token class-name">CuratorFrameworkState</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>curator<span class="token punctuation">.</span>retry<span class="token punctuation">.</span></span><span class="token class-name">RetryNTimes</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span></span><span class="token class-name">CreateMode</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span></span><span class="token class-name">ZooDefs</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CuratorTest</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * Curator ZooKeeper è¿æ¥å®ä¾‹
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">CuratorFramework</span> client <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/mytest&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * åˆ›å»ºè¿æ¥
     */</span>
    <span class="token annotation punctuation">@BeforeAll</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// é‡è¯•ç­–ç•¥</span>
        <span class="token class-name">RetryPolicy</span> retryPolicy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RetryNTimes</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:2181&quot;</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span>retryPolicy<span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">&quot;workspace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//æŒ‡å®šå‘½åç©ºé—´åï¼Œclient çš„æ‰€æœ‰è·¯å¾„æ“ä½œéƒ½ä¼šä»¥ /workspace å¼€å¤´</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å…³é—­è¿æ¥
     */</span>
    <span class="token annotation punctuation">@AfterAll</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>client <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-3-èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥"><a href="#_2-3-èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥" class="header-anchor">#</a> 2.3. èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥</h3> <h4 id="_2-3-1-åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"><a href="#_2-3-1-åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨" class="header-anchor">#</a> 2.3.1. åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Stat</span> stat <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">checkExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNull</span><span class="token punctuation">(</span>stat<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-3-2-åˆ¤è¯»æœåŠ¡çŠ¶æ€"><a href="#_2-3-2-åˆ¤è¯»æœåŠ¡çŠ¶æ€" class="header-anchor">#</a> 2.3.2. åˆ¤è¯»æœåŠ¡çŠ¶æ€</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">CuratorFrameworkState</span> state <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token class-name">CuratorFrameworkState</span><span class="token punctuation">.</span>STARTED<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-3-3-åˆ›å»ºèŠ‚ç‚¹"><a href="#_2-3-3-åˆ›å»ºèŠ‚ç‚¹" class="header-anchor">#</a> 2.3.3. åˆ›å»ºèŠ‚ç‚¹</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// åˆ›å»ºèŠ‚ç‚¹</span>
<span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span>      <span class="token comment">//èŠ‚ç‚¹ç±»å‹</span>
      <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-3-4-åˆ é™¤èŠ‚ç‚¹"><a href="#_2-3-4-åˆ é™¤èŠ‚ç‚¹" class="header-anchor">#</a> 2.3.4. åˆ é™¤èŠ‚ç‚¹</h4> <div class="language-java extra-class"><pre class="language-java"><code>client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">guaranteed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                     <span class="token comment">// å¦‚æœåˆ é™¤å¤±è´¥ï¼Œä¼šç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°æˆåŠŸ</span>
      <span class="token punctuation">.</span><span class="token function">deletingChildrenIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment">// å¦‚æœæœ‰å­èŠ‚ç‚¹ï¼Œåˆ™é€’å½’åˆ é™¤</span>
      <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// ä¼ å…¥ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·é”™è¯¯åˆ™æ‹’ç»åˆ é™¤æ“ä½œï¼Œå¹¶æŠ›å‡º BadVersion å¼‚å¸¸</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-3-5-è·å–èŠ‚ç‚¹æ•°æ®"><a href="#_2-3-5-è·å–èŠ‚ç‚¹æ•°æ®" class="header-anchor">#</a> 2.3.5. è·å–èŠ‚ç‚¹æ•°æ®</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿®æ”¹å‰çš„èŠ‚ç‚¹æ•°æ®ï¼š&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-3-6-è®¾ç½®èŠ‚ç‚¹æ•°æ®"><a href="#_2-3-6-è®¾ç½®èŠ‚ç‚¹æ•°æ®" class="header-anchor">#</a> 2.3.6. è®¾ç½®èŠ‚ç‚¹æ•°æ®</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> text2 <span class="token operator">=</span> <span class="token string">&quot;try again&quot;</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">checkExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> text2<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-3-7-è·å–å­èŠ‚ç‚¹"><a href="#_2-3-7-è·å–å­èŠ‚ç‚¹" class="header-anchor">#</a> 2.3.7. è·å–å­èŠ‚ç‚¹</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> children <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> expectedList <span class="token operator">=</span> <span class="token class-name">CollectionUtil</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">CollectionUtil</span><span class="token punctuation">.</span><span class="token function">containsAll</span><span class="token punctuation">(</span>expectedList<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-4-ç›‘å¬äº‹ä»¶"><a href="#_2-4-ç›‘å¬äº‹ä»¶" class="header-anchor">#</a> 2.4. ç›‘å¬äº‹ä»¶</h3> <h4 id="_2-4-1-åˆ›å»ºä¸€æ¬¡æ€§ç›‘å¬"><a href="#_2-4-1-åˆ›å»ºä¸€æ¬¡æ€§ç›‘å¬" class="header-anchor">#</a> 2.4.1. åˆ›å»ºä¸€æ¬¡æ€§ç›‘å¬</h4> <p>å’Œ Zookeeper åŸç”Ÿç›‘å¬ä¸€æ ·ï¼Œä½¿ç”¨ <code>usingWatcher</code> æ³¨å†Œçš„ç›‘å¬æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå³ç›‘å¬åªä¼šè§¦å‘ä¸€æ¬¡ï¼Œè§¦å‘åå°±é”€æ¯ã€‚</p> <p>ã€ç¤ºä¾‹ã€‘</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// è®¾ç½®ç›‘å¬å™¨</span>
client<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usingWatcher</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CuratorWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;èŠ‚ç‚¹ &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; å‘ç”Ÿäº†äº‹ä»¶ï¼š&quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç¬¬ä¸€æ¬¡ä¿®æ”¹</span>
client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">checkExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;ç¬¬ä¸€æ¬¡ä¿®æ”¹&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç¬¬äºŒæ¬¡ä¿®æ”¹</span>
client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">checkExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;ç¬¬äºŒæ¬¡ä¿®æ”¹&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è¾“å‡º</p> <div class="language- extra-class"><pre class="language-text"><code>èŠ‚ç‚¹ /mytest å‘ç”Ÿäº†äº‹ä»¶ï¼šNodeDataChanged
</code></pre></div><p>è¯´æ˜</p> <p>ä¿®æ”¹ä¸¤æ¬¡æ•°æ®ï¼Œä½†æ˜¯ç›‘å¬å™¨åªä¼šç›‘å¬ç¬¬ä¸€æ¬¡ä¿®æ”¹ã€‚</p> <h4 id="_2-4-2-åˆ›å»ºæ°¸ä¹…ç›‘å¬"><a href="#_2-4-2-åˆ›å»ºæ°¸ä¹…ç›‘å¬" class="header-anchor">#</a> 2.4.2. åˆ›å»ºæ°¸ä¹…ç›‘å¬</h4> <p>Curator è¿˜æä¾›äº†åˆ›å»ºæ°¸ä¹…ç›‘å¬çš„ APIï¼Œå…¶ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// è®¾ç½®ç›‘å¬å™¨</span>
<span class="token class-name">CuratorCache</span> curatorCache <span class="token operator">=</span> <span class="token class-name">CuratorCache</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PathChildrenCacheListener</span> pathChildrenCacheListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PathChildrenCacheListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">childEvent</span><span class="token punctuation">(</span><span class="token class-name">CuratorFramework</span> framework<span class="token punctuation">,</span> <span class="token class-name">PathChildrenCacheEvent</span> event<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;èŠ‚ç‚¹ &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; å‘ç”Ÿäº†äº‹ä»¶ï¼š&quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">CuratorCacheListener</span> listener <span class="token operator">=</span> <span class="token class-name">CuratorCacheListener</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                    <span class="token punctuation">.</span><span class="token function">forPathChildrenCache</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> client<span class="token punctuation">,</span>
                                                        pathChildrenCacheListener<span class="token punctuation">)</span>
                                                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
curatorCache<span class="token punctuation">.</span><span class="token function">listenable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
curatorCache<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç¬¬ä¸€æ¬¡ä¿®æ”¹</span>
client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">checkExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;ç¬¬ä¸€æ¬¡ä¿®æ”¹&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç¬¬äºŒæ¬¡ä¿®æ”¹</span>
client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">checkExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;ç¬¬äºŒæ¬¡ä¿®æ”¹&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-4-3-ç›‘å¬å­èŠ‚ç‚¹"><a href="#_2-4-3-ç›‘å¬å­èŠ‚ç‚¹" class="header-anchor">#</a> 2.4.3. ç›‘å¬å­èŠ‚ç‚¹</h4> <p>è¿™é‡Œä»¥ç›‘å¬ <code>/hadoop</code> ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹ä¸ºä¾‹ï¼Œå®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// åˆ›å»ºèŠ‚ç‚¹</span>
<span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span>      <span class="token comment">//èŠ‚ç‚¹ç±»å‹</span>
      <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span>      <span class="token comment">//èŠ‚ç‚¹ç±»å‹</span>
      <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">&quot;/1&quot;</span><span class="token punctuation">,</span> text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span>      <span class="token comment">//èŠ‚ç‚¹ç±»å‹</span>
      <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">&quot;/2&quot;</span><span class="token punctuation">,</span> text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è®¾ç½®ç›‘å¬å™¨</span>
<span class="token comment">// ç¬¬ä¸‰ä¸ªå‚æ•°ä»£è¡¨é™¤äº†èŠ‚ç‚¹çŠ¶æ€å¤–ï¼Œæ˜¯å¦è¿˜ç¼“å­˜èŠ‚ç‚¹å†…å®¹</span>
<span class="token class-name">PathChildrenCache</span> childrenCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PathChildrenCache</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> path<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
 * StartMode ä»£è¡¨åˆå§‹åŒ–æ–¹å¼:
 *    NORMAL: å¼‚æ­¥åˆå§‹åŒ–
 *    BUILD_INITIAL_CACHE: åŒæ­¥åˆå§‹åŒ–
 *    POST_INITIALIZED_EVENT: å¼‚æ­¥å¹¶é€šçŸ¥,åˆå§‹åŒ–ä¹‹åä¼šè§¦å‘ INITIALIZED äº‹ä»¶
 */</span>
childrenCache<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">PathChildrenCache<span class="token punctuation">.</span>StartMode</span><span class="token punctuation">.</span>POST_INITIALIZED_EVENT<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChildData</span><span class="token punctuation">&gt;</span></span> childDataList <span class="token operator">=</span> childrenCache<span class="token punctuation">.</span><span class="token function">getCurrentData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰æ•°æ®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
childDataList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

childrenCache<span class="token punctuation">.</span><span class="token function">getListenable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathChildrenCacheListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">childEvent</span><span class="token punctuation">(</span><span class="token class-name">CuratorFramework</span> client<span class="token punctuation">,</span> <span class="token class-name">PathChildrenCacheEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> INITIALIZED<span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;childrenCache åˆå§‹åŒ–å®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> CHILD_ADDED<span class="token operator">:</span>
                <span class="token comment">// éœ€è¦æ³¨æ„çš„æ˜¯: å³ä½¿æ˜¯ä¹‹å‰å·²ç»å­˜åœ¨çš„å­èŠ‚ç‚¹ï¼Œä¹Ÿä¼šè§¦å‘è¯¥ç›‘å¬ï¼Œå› ä¸ºä¼šæŠŠè¯¥å­èŠ‚ç‚¹åŠ å…¥ childrenCache ç¼“å­˜ä¸­</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¢åŠ å­èŠ‚ç‚¹:&quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> CHILD_REMOVED<span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ é™¤å­èŠ‚ç‚¹:&quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> CHILD_UPDATED<span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¢«ä¿®æ”¹çš„å­èŠ‚ç‚¹çš„è·¯å¾„:&quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿®æ”¹åçš„æ•°æ®:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç¬¬ä¸€æ¬¡ä¿®æ”¹</span>
client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">&quot;/1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç¬¬ä¸€æ¬¡ä¿®æ”¹&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç¬¬äºŒæ¬¡ä¿®æ”¹</span>
client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">&quot;/1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç¬¬äºŒæ¬¡ä¿®æ”¹&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-5-acl-æƒé™ç®¡ç†"><a href="#_2-5-acl-æƒé™ç®¡ç†" class="header-anchor">#</a> 2.5. ACL æƒé™ç®¡ç†</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AclOperation</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">CuratorFramework</span> client <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> zkServerPath <span class="token operator">=</span> <span class="token string">&quot;192.168.0.226:2181&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> nodePath <span class="token operator">=</span> <span class="token string">&quot;/mytest/hdfs&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RetryPolicy</span> retryPolicy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RetryNTimes</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authorization</span><span class="token punctuation">(</span><span class="token string">&quot;digest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;heibai:123456&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//ç­‰ä»·äº addauth å‘½ä»¤</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span>zkServerPath<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span>retryPolicy<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">&quot;workspace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æ–°å»ºèŠ‚ç‚¹å¹¶èµ‹äºˆæƒé™
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createNodesWithAcl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>ACL<span class="token punctuation">&gt;</span></span> aclList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¯¹å¯†ç è¿›è¡ŒåŠ å¯†</span>
        <span class="token class-name">String</span> digest1 <span class="token operator">=</span> <span class="token class-name">DigestAuthenticationProvider</span><span class="token punctuation">.</span><span class="token function">generateDigest</span><span class="token punctuation">(</span><span class="token string">&quot;heibai:123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> digest2 <span class="token operator">=</span> <span class="token class-name">DigestAuthenticationProvider</span><span class="token punctuation">.</span><span class="token function">generateDigest</span><span class="token punctuation">(</span><span class="token string">&quot;ying:123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Id</span> user01 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Id</span><span class="token punctuation">(</span><span class="token string">&quot;digest&quot;</span><span class="token punctuation">,</span> digest1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Id</span> user02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Id</span><span class="token punctuation">(</span><span class="token string">&quot;digest&quot;</span><span class="token punctuation">,</span> digest2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æŒ‡å®šæ‰€æœ‰æƒé™</span>
        aclList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">ACL</span><span class="token punctuation">(</span><span class="token class-name">Perms</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> user01<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœæƒ³è¦æŒ‡å®šæƒé™çš„ç»„åˆï¼Œä¸­é—´éœ€è¦ä½¿ç”¨ | ,è¿™é‡Œçš„|ä»£è¡¨çš„æ˜¯ä½è¿ç®—ä¸­çš„ æŒ‰ä½æˆ–</span>
        aclList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">ACL</span><span class="token punctuation">(</span><span class="token class-name">Perms</span><span class="token punctuation">.</span>DELETE <span class="token operator">|</span> <span class="token class-name">Perms</span><span class="token punctuation">.</span>CREATE<span class="token punctuation">,</span> user02<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºèŠ‚ç‚¹</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span>aclList<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>nodePath<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * ç»™å·²æœ‰èŠ‚ç‚¹è®¾ç½®æƒé™,æ³¨æ„è¿™ä¼šåˆ é™¤æ‰€æœ‰åŸæ¥èŠ‚ç‚¹ä¸Šå·²æœ‰çš„æƒé™è®¾ç½®
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">SetAcl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> digest <span class="token operator">=</span> <span class="token class-name">DigestAuthenticationProvider</span><span class="token punctuation">.</span><span class="token function">generateDigest</span><span class="token punctuation">(</span><span class="token string">&quot;admin:admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Id</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Id</span><span class="token punctuation">(</span><span class="token string">&quot;digest&quot;</span><span class="token punctuation">,</span> digest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">setACL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">ACL</span><span class="token punctuation">(</span><span class="token class-name">Perms</span><span class="token punctuation">.</span>READ <span class="token operator">|</span> <span class="token class-name">Perms</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>nodePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è·å–æƒé™
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getAcl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>ACL<span class="token punctuation">&gt;</span></span> aclList <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getACL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span>nodePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ACL</span> acl <span class="token operator">=</span> aclList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>acl<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                           <span class="token operator">+</span> <span class="token string">&quot;æ˜¯å¦æœ‰åˆ è¯»æƒé™:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>acl<span class="token punctuation">.</span><span class="token function">getPerms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token class-name">Perms</span><span class="token punctuation">.</span>READ <span class="token operator">|</span> <span class="token class-name">Perms</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>client <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-å‚è€ƒèµ„æ–™"><a href="#_3-å‚è€ƒèµ„æ–™" class="header-anchor">#</a> 3. å‚è€ƒèµ„æ–™</h2> <ul><li><strong>å®˜æ–¹</strong> <ul><li><a href="http://zookeeper.apache.org/" target="_blank" rel="noopener noreferrer">ZooKeeper å®˜ç½‘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER" target="_blank" rel="noopener noreferrer">ZooKeeper å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/apache/zookeeper" target="_blank" rel="noopener noreferrer">ZooKeeper Github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><strong>ä¹¦ç±</strong> <ul><li><a href="https://item.jd.com/12109713.html" target="_blank" rel="noopener noreferrer">ã€ŠHadoop æƒå¨æŒ‡å—ï¼ˆç¬¬å››ç‰ˆï¼‰ã€‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><strong>æ–‡ç« </strong> <ul><li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-zookeeper/index.html" target="_blank" rel="noopener noreferrer">åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ ZooKeeper -- ç®¡ç†åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„æ•°æ®<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/felixzh/p/5869212.html" target="_blank" rel="noopener noreferrer">ZooKeeper çš„åŠŸèƒ½ä»¥åŠå·¥ä½œåŸç†<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/heibaiying/BigData-Notes/blob/master/notes/ZooKeeper%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5.md" target="_blank" rel="noopener noreferrer">ZooKeeper ç®€ä»‹åŠæ ¸å¿ƒæ¦‚å¿µ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://draveness.me/zookeeper-chubby" target="_blank" rel="noopener noreferrer">è¯¦è§£åˆ†å¸ƒå¼åè°ƒæœåŠ¡ ZooKeeper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.jasongj.com/zookeeper/fastleaderelection/" target="_blank" rel="noopener noreferrer">æ·±å…¥æµ…å‡º Zookeeperï¼ˆä¸€ï¼‰ Zookeeper æ¶æ„åŠ FastLeaderElection æœºåˆ¶<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/bigdata-tutorial/edit/master/docs/zookeeper/ZooKeeperJavaApi.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">3 days ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/bigdata-tutorial/assets/js/app.3ada26ba.js" defer></script><script src="/bigdata-tutorial/assets/js/4.cda5e0f1.js" defer></script><script src="/bigdata-tutorial/assets/js/56.ffb4a04b.js" defer></script><script src="/bigdata-tutorial/assets/js/5.9d6e4fe2.js" defer></script>
  </body>
</html>
