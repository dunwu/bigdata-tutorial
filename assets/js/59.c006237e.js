(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{491:function(t,a,s){"use strict";s.r(a);var e=s(20),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"zookeeper-运维指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-运维指南"}},[t._v("#")]),t._v(" ZooKeeper 运维指南")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#1-%E5%8D%95%E7%82%B9%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2"}},[t._v("1. 单点服务部署")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#11-%E4%B8%8B%E8%BD%BD%E8%A7%A3%E5%8E%8B"}},[t._v("1.1. 下载解压")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#12-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"}},[t._v("1.2. 环境变量")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#13-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"}},[t._v("1.3. 修改配置")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#14-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"}},[t._v("1.4. 启动服务")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#15-%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1"}},[t._v("1.5. 停止服务")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#2-%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2"}},[t._v("2. 集群服务部署")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#21-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"}},[t._v("2.1. 修改配置")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#22-%E6%A0%87%E8%AF%86%E8%8A%82%E7%82%B9"}},[t._v("2.2. 标识节点")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#23-%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4"}},[t._v("2.3. 启动集群")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#24-%E9%9B%86%E7%BE%A4%E9%AA%8C%E8%AF%81"}},[t._v("2.4. 集群验证")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#3-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"}},[t._v("3. 参考资料")])])]),t._v(" "),s("h2",{attrs:{id:"_1-单点服务部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-单点服务部署"}},[t._v("#")]),t._v(" 1. 单点服务部署")]),t._v(" "),s("p",[t._v("在安装 ZooKeeper 之前，请确保你的系统是在以下任一操作系统上运行：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("任意 Linux OS")]),t._v(" - 支持开发和部署。适合演示应用程序。")]),t._v(" "),s("li",[s("strong",[t._v("Windows OS")]),t._v(" - 仅支持开发。")]),t._v(" "),s("li",[s("strong",[t._v("Mac OS")]),t._v(" - 仅支持开发。")])]),t._v(" "),s("p",[t._v("安装步骤如下：")]),t._v(" "),s("h3",{attrs:{id:"_1-1-下载解压"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-下载解压"}},[t._v("#")]),t._v(" 1.1. 下载解压")]),t._v(" "),s("p",[t._v("进入官方下载地址："),s("a",{attrs:{href:"http://zookeeper.apache.org/releases.html#download",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://zookeeper.apache.org/releases.html#download"),s("OutboundLink")],1),t._v(" ，选择合适版本。")]),t._v(" "),s("p",[t._v("解压到本地：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxf zookeeper-3.4.6.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" zookeeper-3.4.6\n")])])]),s("h3",{attrs:{id:"_1-2-环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-环境变量"}},[t._v("#")]),t._v(" 1.2. 环境变量")]),t._v(" "),s("p",[t._v("执行 "),s("code",[t._v("vim /etc/profile")]),t._v("，添加环境变量：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ZOOKEEPER_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/app/zookeeper-3.4.14\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ZOOKEEPER_HOME")]),t._v("/bin:"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v("\n")])])]),s("p",[t._v("再执行 "),s("code",[t._v("source /etc/profile")]),t._v(" ， 使得配置的环境变量生效。")]),t._v(" "),s("h3",{attrs:{id:"_1-3-修改配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-修改配置"}},[t._v("#")]),t._v(" 1.3. 修改配置")]),t._v(" "),s("p",[t._v("你必须创建 "),s("code",[t._v("conf/zoo.cfg")]),t._v(" 文件，否则启动时会提示你没有此文件。")]),t._v(" "),s("p",[t._v("初次尝试，不妨直接使用 Kafka 提供的模板配置文件 "),s("code",[t._v("conf/zoo_sample.cfg")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" conf/zoo_sample.cfg conf/zoo.cfg\n")])])]),s("p",[t._v("修改后完整配置如下：")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of milliseconds of each tick")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of ticks that the initial")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# synchronization phase can take")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of ticks that can pass between")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sending a request and getting an acknowledgement")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the directory where the snapshot is stored.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# do not use /tmp for storage, /tmp here is just")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# example sakes.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/zookeeper/data")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataLogDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/zookeeper/log")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the port at which the clients will connect")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2181")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the maximum number of client connections.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# increase this if you need to handle more clients")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#maxClientCnxns=60")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Be sure to read the maintenance section of the")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# administrator guide before turning on autopurge.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of snapshots to retain in dataDir")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#autopurge.snapRetainCount=3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Purge task interval in hours")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Set to "0" to disable auto purge feature')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#autopurge.purgeInterval=1")]),t._v("\n")])])]),s("p",[t._v("配置参数说明：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("tickTime")]),t._v("：用于计算的基础时间单元。比如 session 超时：N*tickTime；")]),t._v(" "),s("li",[s("strong",[t._v("initLimit")]),t._v("：用于集群，允许从节点连接并同步到 master 节点的初始化连接时间，以 tickTime 的倍数来表示；")]),t._v(" "),s("li",[s("strong",[t._v("syncLimit")]),t._v("：用于集群， master 主节点与从节点之间发送消息，请求和应答时间长度（心跳机制）；")]),t._v(" "),s("li",[s("strong",[t._v("dataDir")]),t._v("：数据存储位置；")]),t._v(" "),s("li",[s("strong",[t._v("dataLogDir")]),t._v("：日志目录；")]),t._v(" "),s("li",[s("strong",[t._v("clientPort")]),t._v("：用于客户端连接的端口，默认 2181")])]),t._v(" "),s("h3",{attrs:{id:"_1-4-启动服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-启动服务"}},[t._v("#")]),t._v(" 1.4. 启动服务")]),t._v(" "),s("p",[t._v("执行以下命令")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bin/zkServer.sh start\n")])])]),s("p",[t._v("执行此命令后，你将收到以下响应")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("JMX enabled by default\nUsing config: /Users/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/zookeeper-3.4.6/bin/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/conf/zoo.cfg\nStarting zookeeper "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". STARTED\n")])])]),s("h3",{attrs:{id:"_1-5-停止服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-停止服务"}},[t._v("#")]),t._v(" 1.5. 停止服务")]),t._v(" "),s("p",[t._v("可以使用以下命令停止 zookeeper 服务器。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bin/zkServer.sh stop\n")])])]),s("h2",{attrs:{id:"_2-集群服务部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-集群服务部署"}},[t._v("#")]),t._v(" 2. 集群服务部署")]),t._v(" "),s("p",[t._v("分布式系统节点数一般都要求是奇数，且最少为 3 个节点，Zookeeper 也不例外。")]),t._v(" "),s("p",[t._v("这里，规划一个含 3 个节点的最小 ZooKeeper 集群，主机名分别为 hadoop001，hadoop002，hadoop003 。")]),t._v(" "),s("h3",{attrs:{id:"_2-1-修改配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-修改配置"}},[t._v("#")]),t._v(" 2.1. 修改配置")]),t._v(" "),s("p",[t._v("修改配置文件 "),s("code",[t._v("zoo.cfg")]),t._v("，内容如下：")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/zookeeper-cluster/data/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataLogDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/zookeeper-cluster/log/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2181")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# server.1 这个1是服务器的标识，可以是任意有效数字，标识这是第几个服务器节点，这个标识要写到dataDir目录下面myid文件里")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指名集群间通讯端口和选举端口")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("hadoop001:2287:3387")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("hadoop002:2287:3387")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server.3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("hadoop003:2287:3387")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-2-标识节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-标识节点"}},[t._v("#")]),t._v(" 2.2. 标识节点")]),t._v(" "),s("p",[t._v("分别在三台主机的 "),s("code",[t._v("dataDir")]),t._v(" 目录下新建 "),s("code",[t._v("myid")]),t._v(" 文件,并写入对应的节点标识。Zookeeper 集群通过 "),s("code",[t._v("myid")]),t._v(" 文件识别集群节点，并通过上文配置的节点通信端口和选举端口来进行节点通信，选举出 Leader 节点。")]),t._v(" "),s("p",[t._v("创建存储目录：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 三台主机均执行该命令")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -vp  /usr/local/zookeeper-cluster/data/\n")])])]),s("p",[t._v("创建并写入节点标识到 "),s("code",[t._v("myid")]),t._v(" 文件：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hadoop001主机")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /usr/local/zookeeper-cluster/data/myid\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hadoop002主机")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /usr/local/zookeeper-cluster/data/myid\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hadoop003主机")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /usr/local/zookeeper-cluster/data/myid\n")])])]),s("h3",{attrs:{id:"_2-3-启动集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-启动集群"}},[t._v("#")]),t._v(" 2.3. 启动集群")]),t._v(" "),s("p",[t._v("分别在三台主机上，执行如下命令启动服务：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("/usr/app/zookeeper-cluster/zookeeper/bin/zkServer.sh start\n")])])]),s("h3",{attrs:{id:"_2-4-集群验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-集群验证"}},[t._v("#")]),t._v(" 2.4. 集群验证")]),t._v(" "),s("p",[t._v("启动后使用 "),s("code",[t._v("zkServer.sh status")]),t._v(" 查看集群各个节点状态。")]),t._v(" "),s("h2",{attrs:{id:"_3-参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-参考资料"}},[t._v("#")]),t._v(" 3. 参考资料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.w3cschool.cn/zookeeper/zookeeper_installation.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Zookeeper 安装"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/heibaiying/BigData-Notes/blob/master/notes/installation/Zookeeper%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E5%92%8C%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Zookeeper 单机环境和集群环境搭建"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.runoob.com/w3cnote/zookeeper-bs-command.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Zookeeper 客户端基础命令使用"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);