<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flink äº‹ä»¶é©±åŠ¨ | BIGDATA-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/bigdata-tutorial/favicon.ico">
    <meta name="description" content="å¤§æ•°æ®æ•™ç¨‹">
    
    <link rel="preload" href="/bigdata-tutorial/assets/css/0.styles.eecf7a64.css" as="style"><link rel="preload" href="/bigdata-tutorial/assets/js/app.3ada26ba.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/4.cda5e0f1.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/14.a9835374.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/5.9d6e4fe2.js" as="script"><link rel="prefetch" href="/bigdata-tutorial/assets/js/10.1ab7bd74.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/11.a42f7604.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/12.7dce2ed8.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/13.1b26207d.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/15.90c66596.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/16.e0471453.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/17.2c0565cb.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/18.fabbce00.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/19.c120a108.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/20.5a4f48af.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/21.d3fce730.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/22.00ac574a.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/23.754595c9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/24.fc9d31a1.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/25.d4313bcb.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/26.604f045b.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/27.22a239b2.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/28.466b9a71.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/29.2783ebfd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/30.2ff3250e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/31.2c64e404.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/32.0ab8b31c.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/33.be38d2dc.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/34.811f6626.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/35.9d9f3847.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/36.32bb3f84.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/37.db182f29.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/38.91a9d6f3.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/39.1148f971.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/40.1536c75c.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/41.31725066.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/42.68e59bdd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/43.9bac72d5.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/44.a2edd3e0.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/45.4a1cf2ae.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/46.d8a80a79.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/47.9621b1a5.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/48.56d4fa14.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/49.d9d143dd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/50.6e4aa6cd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/51.55771fda.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/52.ee51188b.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/53.b014e486.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/54.ae66c176.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/55.2ea9bfd9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/56.ffb4a04b.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/57.bdee2f7e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/58.982c2219.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/59.c006237e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/6.3bb0b816.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/60.b27dc3c8.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/7.d55602d2.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/8.89e9ace9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/9.0c40eb95.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/vendors~flowchart.5998caa6.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/vendors~notification.943e54fe.js">
    <link rel="stylesheet" href="/bigdata-tutorial/assets/css/0.styles.eecf7a64.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bigdata-tutorial/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo-200.png" alt="BIGDATA-TUTORIAL" class="logo"> <span class="site-name can-hide">BIGDATA-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bigdata-tutorial/hive/" class="nav-link">
  Hive
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hdfs/" class="nav-link">
  Hdfs
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hbase/" class="nav-link">
  Hbase
</a></div><div class="nav-item"><a href="/bigdata-tutorial/zookeeper/" class="nav-link">
  ZooKeeper
</a></div><div class="nav-item"><a href="/bigdata-tutorial/kafka/" class="nav-link">
  Kafka
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/bigdata-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bigdata-tutorial/hive/" class="nav-link">
  Hive
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hdfs/" class="nav-link">
  Hdfs
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hbase/" class="nav-link">
  Hbase
</a></div><div class="nav-item"><a href="/bigdata-tutorial/zookeeper/" class="nav-link">
  ZooKeeper
</a></div><div class="nav-item"><a href="/bigdata-tutorial/kafka/" class="nav-link">
  Kafka
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">âœ¨ Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ¯ åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/bigdata-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Flink äº‹ä»¶é©±åŠ¨</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bigdata-tutorial/flink/Flink%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8.html#å¤„ç†å‡½æ•°-process-functions" class="sidebar-link">å¤„ç†å‡½æ•°ï¼ˆProcess Functionsï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata-tutorial/flink/Flink%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8.html#ç®€ä»‹" class="sidebar-link">ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/flink/Flink%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8.html#ç¤ºä¾‹" class="sidebar-link">ç¤ºä¾‹</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/flink/Flink%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8.html#æ€§èƒ½è€ƒè™‘" class="sidebar-link">æ€§èƒ½è€ƒè™‘</a></li></ul></li><li><a href="/bigdata-tutorial/flink/Flink%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8.html#æ—è·¯è¾“å‡º-side-outputs" class="sidebar-link">æ—è·¯è¾“å‡ºï¼ˆSide Outputsï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata-tutorial/flink/Flink%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8.html#ç®€ä»‹-2" class="sidebar-link">ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/flink/Flink%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8.html#ç¤ºä¾‹-2" class="sidebar-link">ç¤ºä¾‹</a></li></ul></li><li><a href="/bigdata-tutorial/flink/Flink%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8.html#ç»“è¯­" class="sidebar-link">ç»“è¯­</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/flink/Flink%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8.html#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="flink-äº‹ä»¶é©±åŠ¨"><a href="#flink-äº‹ä»¶é©±åŠ¨" class="header-anchor">#</a> Flink äº‹ä»¶é©±åŠ¨</h1> <h2 id="å¤„ç†å‡½æ•°-process-functions"><a href="#å¤„ç†å‡½æ•°-process-functions" class="header-anchor">#</a> å¤„ç†å‡½æ•°ï¼ˆProcess Functionsï¼‰</h2> <h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="header-anchor">#</a> ç®€ä»‹</h3> <p><code>ProcessFunction</code> å°†äº‹ä»¶å¤„ç†ä¸ Timerï¼ŒState ç»“åˆåœ¨ä¸€èµ·ï¼Œä½¿å…¶æˆä¸ºæµå¤„ç†åº”ç”¨çš„å¼ºå¤§æ„å»ºæ¨¡å—ã€‚ è¿™æ˜¯ä½¿ç”¨ Flink åˆ›å»ºäº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºçš„åŸºç¡€ã€‚å®ƒå’Œ <code>RichFlatMapFunction</code> ååˆ†ç›¸ä¼¼ï¼Œ ä½†æ˜¯å¢åŠ äº† Timerã€‚</p> <h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="header-anchor">#</a> ç¤ºä¾‹</h3> <p>å¦‚æœä½ å·²ç»ä½“éªŒäº† <a href="https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/learn-flink/streaming_analytics/" target="_blank" rel="noopener noreferrer">æµå¼åˆ†æè®­ç»ƒ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> çš„<a href="https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/learn-flink/streaming_analytics/#hands-on" target="_blank" rel="noopener noreferrer">åŠ¨æ‰‹å®è·µ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œ ä½ åº”è¯¥è®°å¾—ï¼Œå®ƒæ˜¯é‡‡ç”¨ <code>TumblingEventTimeWindow</code> æ¥è®¡ç®—æ¯ä¸ªå°æ—¶å†…æ¯ä¸ªå¸æœºçš„å°è´¹æ€»å’Œï¼Œ åƒä¸‹é¢çš„ç¤ºä¾‹è¿™æ ·ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// è®¡ç®—æ¯ä¸ªå¸æœºæ¯å°æ—¶çš„å°è´¹æ€»å’Œ</span>
<span class="token class-name">DataStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple3</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> hourlyTips <span class="token operator">=</span> fares
        <span class="token punctuation">.</span><span class="token function">keyBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TaxiFare</span> fare<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> fare<span class="token punctuation">.</span>driverId<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token class-name">TumblingEventTimeWindows</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Time</span><span class="token punctuation">.</span><span class="token function">hours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AddTips</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä½¿ç”¨ <code>KeyedProcessFunction</code> å»å®ç°ç›¸åŒçš„æ“ä½œæ›´åŠ ç›´æ¥ä¸”æ›´æœ‰å­¦ä¹ æ„ä¹‰ã€‚ è®©æˆ‘ä»¬å¼€å§‹ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢ä¸Šé¢çš„ä»£ç ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// è®¡ç®—æ¯ä¸ªå¸æœºæ¯å°æ—¶çš„å°è´¹æ€»å’Œ</span>
<span class="token class-name">DataStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple3</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> hourlyTips <span class="token operator">=</span> fares
        <span class="token punctuation">.</span><span class="token function">keyBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TaxiFare</span> fare<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> fare<span class="token punctuation">.</span>driverId<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PseudoWindow</span><span class="token punctuation">(</span><span class="token class-name">Time</span><span class="token punctuation">.</span><span class="token function">hours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>åœ¨è¿™ä¸ªä»£ç ç‰‡æ®µä¸­ï¼Œä¸€ä¸ªåä¸º <code>PseudoWindow</code> çš„ <code>KeyedProcessFunction</code> è¢«åº”ç”¨äº KeyedStreamï¼Œ å…¶ç»“æœæ˜¯ä¸€ä¸ª <code>DataStream&lt;Tuple3&lt;Long, Long, Float&gt;&gt;</code> ï¼ˆä¸ä½¿ç”¨ Flink å†…ç½®æ—¶é—´çª—å£çš„å®ç°ç”Ÿæˆçš„æµç›¸åŒï¼‰ã€‚</p> <p><code>PseudoWindow</code> çš„æ€»ä½“è½®å»“ç¤ºæ„å¦‚ä¸‹ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// åœ¨æ—¶é•¿è·¨åº¦ä¸ºä¸€å°æ—¶çš„çª—å£ä¸­è®¡ç®—æ¯ä¸ªå¸æœºçš„å°è´¹æ€»å’Œã€‚</span>
<span class="token comment">// å¸æœºIDä½œä¸º keyã€‚</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">PseudoWindow</span> <span class="token keyword">extends</span>
        <span class="token class-name">KeyedProcessFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">TaxiFare</span><span class="token punctuation">,</span> <span class="token class-name">Tuple3</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">long</span> durationMsec<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PseudoWindow</span><span class="token punctuation">(</span><span class="token class-name">Time</span> duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>durationMsec <span class="token operator">=</span> duration<span class="token punctuation">.</span><span class="token function">toMilliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token comment">// åœ¨åˆå§‹åŒ–æœŸé—´è°ƒç”¨ä¸€æ¬¡ã€‚</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> conf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token comment">// æ¯ä¸ªç¥¨ä»·äº‹ä»¶ï¼ˆTaxiFare-Eventï¼‰è¾“å…¥ï¼ˆåˆ°è¾¾ï¼‰æ—¶è°ƒç”¨ï¼Œä»¥å¤„ç†è¾“å…¥çš„ç¥¨ä»·äº‹ä»¶ã€‚</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processElement</span><span class="token punctuation">(</span>
            <span class="token class-name">TaxiFare</span> fare<span class="token punctuation">,</span>
            <span class="token class-name">Context</span> ctx<span class="token punctuation">,</span>
            <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple3</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token comment">// å½“å½“å‰æ°´å°ï¼ˆwatermarkï¼‰è¡¨æ˜çª—å£ç°åœ¨éœ€è¦å®Œæˆçš„æ—¶å€™è°ƒç”¨ã€‚</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onTimer</span><span class="token punctuation">(</span><span class="token keyword">long</span> timestamp<span class="token punctuation">,</span>
            <span class="token class-name">OnTimerContext</span> context<span class="token punctuation">,</span>
            <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple3</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ³¨æ„äº‹é¡¹ï¼š</p> <ul><li>æœ‰å‡ ç§ç±»å‹çš„ ProcessFunctions â€“ ä¸ä»…åŒ…æ‹¬ <code>KeyedProcessFunction</code>ï¼Œè¿˜åŒ…æ‹¬ <code>CoProcessFunctions</code>ã€<code>BroadcastProcessFunctions</code> ç­‰.</li> <li><code>KeyedProcessFunction</code> æ˜¯ä¸€ç§ <code>RichFunction</code>ã€‚ä½œä¸º <code>RichFunction</code>ï¼Œå®ƒå¯ä»¥è®¿é—®ä½¿ç”¨ Managed Keyed State æ‰€éœ€çš„ <code>open</code> å’Œ <code>getRuntimeContext</code> æ–¹æ³•ã€‚</li> <li>æœ‰ä¸¤ä¸ªå›è°ƒæ–¹æ³•é¡»è¦å®ç°ï¼š <code>processElement</code> å’Œ <code>onTimer</code>ã€‚æ¯ä¸ªè¾“å…¥äº‹ä»¶éƒ½ä¼šè°ƒç”¨ <code>processElement</code> æ–¹æ³•ï¼› å½“è®¡æ—¶å™¨è§¦å‘æ—¶è°ƒç”¨ <code>onTimer</code>ã€‚å®ƒä»¬å¯ä»¥æ˜¯åŸºäºäº‹ä»¶æ—¶é—´ï¼ˆevent timeï¼‰çš„ timerï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºå¤„ç†æ—¶é—´ï¼ˆprocessing timeï¼‰çš„ timerã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œ<code>processElement</code> å’Œ <code>onTimer</code> éƒ½æä¾›äº†ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ç”¨äºä¸ <code>TimerService</code> äº¤äº’ã€‚ è¿™ä¸¤ä¸ªå›è°ƒè¿˜ä¼ é€’äº†ä¸€ä¸ªå¯ç”¨äºå‘å‡ºç»“æœçš„ <code>Collector</code>ã€‚</li></ul> <h4 id="open-æ–¹æ³•"><a href="#open-æ–¹æ³•" class="header-anchor">#</a> <code>open()</code> æ–¹æ³•</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// æ¯ä¸ªçª—å£éƒ½æŒæœ‰æ‰˜ç®¡çš„ Keyed state çš„å…¥å£ï¼Œå¹¶ä¸”æ ¹æ®çª—å£çš„ç»“æŸæ—¶é—´æ‰§è¡Œ keyed ç­–ç•¥ã€‚</span>
<span class="token comment">// æ¯ä¸ªå¸æœºéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„MapStateå¯¹è±¡ã€‚</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">MapState</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span></span> sumOfTips<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> conf<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">MapStateDescriptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span></span> sumDesc <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">MapStateDescriptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;sumOfTips&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sumOfTips <span class="token operator">=</span> <span class="token function">getRuntimeContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMapState</span><span class="token punctuation">(</span>sumDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç”±äºç¥¨ä»·äº‹ä»¶ï¼ˆfare-eventï¼‰å¯èƒ½ä¼šä¹±åºåˆ°è¾¾ï¼Œæœ‰æ—¶éœ€è¦åœ¨è®¡ç®—è¾“å‡ºå‰ä¸€ä¸ªå°æ—¶ç»“æœå‰ï¼Œå¤„ç†ä¸‹ä¸€ä¸ªå°æ—¶çš„äº‹ä»¶ã€‚ è¿™æ ·èƒ½å¤Ÿä¿è¯â€œä¹±åºé€ æˆçš„å»¶è¿Ÿæ•°æ®â€å¾—åˆ°æ­£ç¡®å¤„ç†ï¼ˆæ”¾åˆ°å‰ä¸€ä¸ªå°æ—¶ä¸­ï¼‰ã€‚ å®é™…ä¸Šï¼Œå¦‚æœ Watermark å»¶è¿Ÿæ¯”çª—å£é•¿åº¦é•¿å¾—å¤šï¼Œåˆ™å¯èƒ½æœ‰å¤šä¸ªçª—å£åŒæ—¶æ‰“å¼€ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸¤ä¸ªã€‚ æ­¤å®ç°é€šè¿‡ä½¿ç”¨ <code>MapState</code> æ¥æ”¯æŒå¤„ç†è¿™ä¸€ç‚¹ï¼Œè¯¥ <code>MapState</code> å°†æ¯ä¸ªçª—å£çš„ç»“æŸæ—¶é—´æˆ³æ˜ å°„åˆ°è¯¥çª—å£çš„å°è´¹æ€»å’Œã€‚</p> <h4 id="processelement-æ–¹æ³•"><a href="#processelement-æ–¹æ³•" class="header-anchor">#</a> <code>processElement()</code> æ–¹æ³•</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processElement</span><span class="token punctuation">(</span>
        <span class="token class-name">TaxiFare</span> fare<span class="token punctuation">,</span>
        <span class="token class-name">Context</span> ctx<span class="token punctuation">,</span>
        <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple3</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">long</span> eventTime <span class="token operator">=</span> fare<span class="token punctuation">.</span><span class="token function">getEventTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TimerService</span> timerService <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">timerService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTime <span class="token operator">&lt;=</span> timerService<span class="token punctuation">.</span><span class="token function">currentWatermark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// äº‹ä»¶å»¶è¿Ÿï¼›å…¶å¯¹åº”çš„çª—å£å·²ç»è§¦å‘ã€‚</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// å°† eventTime å‘ä¸Šå–å€¼å¹¶å°†ç»“æœèµ‹å€¼åˆ°åŒ…å«å½“å‰äº‹ä»¶çš„çª—å£çš„æœ«å°¾æ—¶é—´ç‚¹ã€‚</span>
        <span class="token keyword">long</span> endOfWindow <span class="token operator">=</span> <span class="token punctuation">(</span>eventTime <span class="token operator">-</span> <span class="token punctuation">(</span>eventTime <span class="token operator">%</span> durationMsec<span class="token punctuation">)</span> <span class="token operator">+</span> durationMsec <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åœ¨çª—å£å®Œæˆæ—¶å°†å¯ç”¨å›è°ƒ</span>
        timerService<span class="token punctuation">.</span><span class="token function">registerEventTimeTimer</span><span class="token punctuation">(</span>endOfWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å°†æ­¤ç¥¨ä»·çš„å°è´¹æ·»åŠ åˆ°è¯¥çª—å£çš„æ€»è®¡ä¸­ã€‚</span>
        <span class="token class-name">Float</span> sum <span class="token operator">=</span> sumOfTips<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>endOfWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sum <span class="token operator">=</span> <span class="token number">0.0F</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        sum <span class="token operator">+=</span> fare<span class="token punctuation">.</span>tip<span class="token punctuation">;</span>
        sumOfTips<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>endOfWindow<span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>éœ€è¦è€ƒè™‘çš„äº‹é¡¹ï¼š</p> <ul><li>å»¶è¿Ÿçš„äº‹ä»¶æ€ä¹ˆå¤„ç†ï¼Ÿwatermark åé¢çš„äº‹ä»¶ï¼ˆå³å»¶è¿Ÿçš„ï¼‰æ­£åœ¨è¢«åˆ é™¤ã€‚ å¦‚æœä½ æƒ³åšä¸€äº›æ¯”è¿™æ›´é«˜çº§çš„æ“ä½œï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ—è·¯è¾“å‡ºï¼ˆSide outputsï¼‰ï¼Œè¿™å°†åœ¨<a href="https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/learn-flink/event_driven/#side-outputs" target="_blank" rel="noopener noreferrer">ä¸‹ä¸€èŠ‚<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­è§£é‡Šã€‚</li> <li>æœ¬ä¾‹ä½¿ç”¨ä¸€ä¸ª <code>MapState</code>ï¼Œå…¶ä¸­ keys æ˜¯æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ï¼Œå¹¶ä¸ºåŒä¸€æ—¶é—´æˆ³è®¾ç½®ä¸€ä¸ª Timerã€‚ è¿™æ˜¯ä¸€ç§å¸¸è§çš„æ¨¡å¼ï¼›å®ƒä½¿å¾—åœ¨ Timer è§¦å‘æ—¶æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯å˜å¾—ç®€å•é«˜æ•ˆã€‚</li></ul> <h4 id="ontimer-æ–¹æ³•"><a href="#ontimer-æ–¹æ³•" class="header-anchor">#</a> <code>onTimer()</code> æ–¹æ³•</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onTimer</span><span class="token punctuation">(</span>
        <span class="token keyword">long</span> timestamp<span class="token punctuation">,</span>
        <span class="token class-name">OnTimerContext</span> context<span class="token punctuation">,</span>
        <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple3</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token keyword">long</span> driverId <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getCurrentKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æŸ¥æ‰¾åˆšç»“æŸçš„ä¸€å°æ—¶ç»“æœã€‚</span>
    <span class="token class-name">Float</span> sumOfTips <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sumOfTips<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Tuple3</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Float</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token class-name">Tuple3</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>driverId<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> sumOfTips<span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sumOfTips<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ³¨æ„ï¼š</p> <ul><li>ä¼ é€’ç»™ <code>onTimer</code> çš„ <code>OnTimerContext context</code> å¯ç”¨äºç¡®å®šå½“å‰ keyã€‚</li> <li>æˆ‘ä»¬çš„ pseudo-windows åœ¨å½“å‰ Watermark åˆ°è¾¾æ¯å°æ—¶ç»“æŸæ—¶è§¦å‘ï¼Œæ­¤æ—¶è°ƒç”¨ <code>onTimer</code>ã€‚ è¿™ä¸ª <code>onTimer</code> æ–¹æ³•ä» <code>sumOfTips</code> ä¸­åˆ é™¤ç›¸å…³çš„æ¡ç›®ï¼Œè¿™æ ·åšçš„æ•ˆæœæ˜¯ä¸å¯èƒ½å®¹çº³å»¶è¿Ÿçš„äº‹ä»¶ã€‚ è¿™ç›¸å½“äºåœ¨ä½¿ç”¨ Flink çš„æ—¶é—´çª—å£æ—¶å°† allowedLateness è®¾ç½®ä¸ºé›¶ã€‚</li></ul> <h3 id="æ€§èƒ½è€ƒè™‘"><a href="#æ€§èƒ½è€ƒè™‘" class="header-anchor">#</a> æ€§èƒ½è€ƒè™‘</h3> <p>Flink æä¾›äº†ä¸º RocksDB ä¼˜åŒ–çš„ <code>MapState</code> å’Œ <code>ListState</code> ç±»å‹ã€‚ ç›¸å¯¹äº <code>ValueState</code>ï¼Œæ›´å»ºè®®ä½¿ç”¨ <code>MapState</code> å’Œ <code>ListState</code>ï¼Œå› ä¸ºä½¿ç”¨ RocksDBStateBackend çš„æƒ…å†µä¸‹ï¼Œ <code>MapState</code> å’Œ <code>ListState</code> æ¯” <code>ValueState</code> æ€§èƒ½æ›´å¥½ã€‚ RocksDBStateBackend å¯ä»¥é™„åŠ åˆ° <code>ListState</code>ï¼Œè€Œæ— éœ€è¿›è¡Œï¼ˆåï¼‰åºåˆ—åŒ–ï¼Œ å¯¹äº <code>MapState</code>ï¼Œæ¯ä¸ª key/value éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„ RocksDB å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆåœ°è®¿é—®å’Œæ›´æ–° <code>MapState</code>ã€‚</p> <h2 id="æ—è·¯è¾“å‡º-side-outputs"><a href="#æ—è·¯è¾“å‡º-side-outputs" class="header-anchor">#</a> æ—è·¯è¾“å‡ºï¼ˆSide Outputsï¼‰</h2> <h3 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="header-anchor">#</a> ç®€ä»‹</h3> <p>æœ‰å‡ ä¸ªå¾ˆå¥½çš„ç†ç”±å¸Œæœ›ä» Flink ç®—å­è·å¾—å¤šä¸ªè¾“å‡ºæµï¼Œå¦‚ä¸‹æŠ¥å‘Šæ¡ç›®ï¼š</p> <ul><li>å¼‚å¸¸æƒ…å†µï¼ˆexceptionsï¼‰</li> <li>æ ¼å¼é”™è¯¯çš„äº‹ä»¶ï¼ˆmalformed eventsï¼‰</li> <li>å»¶è¿Ÿçš„äº‹ä»¶ï¼ˆlate eventsï¼‰</li> <li>operator å‘Šè­¦ï¼ˆoperational alertsï¼‰ï¼Œå¦‚ä¸å¤–éƒ¨æœåŠ¡çš„è¿æ¥è¶…æ—¶</li></ul> <p>æ—è·¯è¾“å‡ºï¼ˆSide outputsï¼‰æ˜¯ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•ã€‚é™¤äº†é”™è¯¯æŠ¥å‘Šä¹‹å¤–ï¼Œæ—è·¯è¾“å‡ºä¹Ÿæ˜¯å®ç°æµçš„ n è·¯åˆ†å‰²çš„å¥½æ–¹æ³•ã€‚</p> <h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="header-anchor">#</a> ç¤ºä¾‹</h3> <p>ç°åœ¨ä½ å¯ä»¥å¯¹ä¸Šä¸€èŠ‚ä¸­å¿½ç•¥çš„å»¶è¿Ÿäº‹ä»¶æ‰§è¡ŒæŸäº›æ“ä½œã€‚</p> <p>Side output channel ä¸ <code>OutputTag&lt;T&gt;</code> ç›¸å…³è”ã€‚è¿™äº›æ ‡è®°æ‹¥æœ‰è‡ªå·±çš„åç§°ï¼Œå¹¶ä¸å¯¹åº” DataStream ç±»å‹ä¸€è‡´ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">OutputTag</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TaxiFare</span><span class="token punctuation">&gt;</span></span> lateFares <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputTag</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TaxiFare</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;lateFares&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>ä¸Šé¢æ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªé™æ€ <code>OutputTag&lt;TaxiFare&gt;</code> ï¼Œå½“åœ¨ <code>PseudoWindow</code> çš„ <code>processElement</code> æ–¹æ³•ä¸­å‘å‡ºå»¶è¿Ÿäº‹ä»¶æ—¶ï¼Œå¯ä»¥å¼•ç”¨å®ƒï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>eventTime <span class="token operator">&lt;=</span> timerService<span class="token punctuation">.</span><span class="token function">currentWatermark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// äº‹ä»¶å»¶è¿Ÿï¼Œå…¶å¯¹åº”çš„çª—å£å·²ç»è§¦å‘ã€‚</span>
    ctx<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span>lateFares<span class="token punctuation">,</span> fare<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä»¥åŠå½“åœ¨ä½œä¸šçš„ <code>main</code> ä¸­ä»è¯¥æ—è·¯è¾“å‡ºè®¿é—®æµæ—¶ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// è®¡ç®—æ¯ä¸ªå¸æœºæ¯å°æ—¶çš„å°è´¹æ€»å’Œ</span>
<span class="token class-name">SingleOutputStreamOperator</span> hourlyTips <span class="token operator">=</span> fares
        <span class="token punctuation">.</span><span class="token function">keyBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TaxiFare</span> fare<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> fare<span class="token punctuation">.</span>driverId<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PseudoWindow</span><span class="token punctuation">(</span><span class="token class-name">Time</span><span class="token punctuation">.</span><span class="token function">hours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hourlyTips<span class="token punctuation">.</span><span class="token function">getSideOutput</span><span class="token punctuation">(</span>lateFares<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªåŒåçš„ OutputTag æ¥å¼•ç”¨åŒä¸€ä¸ªæ—è·¯è¾“å‡ºï¼Œä½†å¦‚æœè¿™æ ·åšï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚</p> <h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="header-anchor">#</a> ç»“è¯­</h2> <p>åœ¨æœ¬ä¾‹ä¸­ï¼Œä½ å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨ <code>ProcessFunction</code> é‡æ–°å®ç°ä¸€ä¸ªç®€å•çš„æ—¶é—´çª—å£ã€‚ å½“ç„¶ï¼Œå¦‚æœ Flink å†…ç½®çš„çª—å£ API èƒ½å¤Ÿæ»¡è¶³ä½ çš„å¼€å‘éœ€æ±‚ï¼Œé‚£ä¹ˆä¸€å®šè¦ä¼˜å…ˆä½¿ç”¨å®ƒã€‚ ä½†å¦‚æœä½ å‘ç°è‡ªå·±åœ¨è€ƒè™‘ç”¨ Flink çš„çª—å£åšäº›é”™ç»¼å¤æ‚çš„äº‹æƒ…ï¼Œä¸è¦å®³æ€•è‡ªå·±åŠ¨æ‰‹ã€‚</p> <p>æ­¤å¤–ï¼Œ<code>ProcessFunctions</code> å¯¹äºè®¡ç®—åˆ†æä¹‹å¤–çš„è®¸å¤šå…¶ä»–ç”¨ä¾‹ä¹Ÿå¾ˆæœ‰ç”¨ã€‚ ä¸‹é¢çš„å®è·µç»ƒä¹ æä¾›äº†ä¸€ä¸ªå®Œå…¨ä¸åŒçš„ä¾‹å­ã€‚</p> <p><code>ProcessFunctions</code> çš„å¦ä¸€ä¸ªå¸¸è§ç”¨ä¾‹æ˜¯æ¸…ç†è¿‡æ—¶ Stateã€‚å¦‚æœä½ å›æƒ³ä¸€ä¸‹ <a href="https://github.com/apache/flink-training/blob/release-1.14//rides-and-fares" target="_blank" rel="noopener noreferrer">Rides and Fares Exercise <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œ å…¶ä¸­ä½¿ç”¨ <code>RichCoFlatMapFunction</code> æ¥è®¡ç®—ç®€å• Joinï¼Œé‚£ä¹ˆç¤ºä¾‹æ–¹æ¡ˆå‡è®¾ TaxiRides å’Œ TaxiFares ä¸¤ä¸ªäº‹ä»¶æ˜¯ä¸¥æ ¼åŒ¹é…ä¸ºä¸€ä¸ªæœ‰æ•ˆ æ•°æ®å¯¹ï¼ˆå¿…é¡»åŒæ—¶å‡ºç°ï¼‰å¹¶ä¸”æ¯ä¸€ç»„è¿™æ ·çš„æœ‰æ•ˆæ•°æ®å¯¹éƒ½å’Œä¸€ä¸ªå”¯ä¸€çš„ <code>rideId</code> ä¸¥æ ¼å¯¹åº”ã€‚å¦‚æœæ•°æ®å¯¹ä¸­çš„æŸä¸ª TaxiRides äº‹ä»¶ï¼ˆTaxiFares äº‹ä»¶ï¼‰ ä¸¢å¤±ï¼Œåˆ™åŒä¸€ <code>rideId</code> å¯¹åº”çš„å¦ä¸€ä¸ªå‡ºç°çš„ TaxiFares äº‹ä»¶ï¼ˆTaxiRides äº‹ä»¶ï¼‰å¯¹åº”çš„ State åˆ™æ°¸è¿œä¸ä¼šè¢«æ¸…ç†æ‰ã€‚ æ‰€ä»¥è¿™é‡Œå¯ä»¥ä½¿ç”¨ <code>KeyedCoProcessFunction</code> çš„å®ç°ä»£æ›¿å®ƒï¼ˆ<code>RichCoFlatMapFunction</code>ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨è®¡æ—¶å™¨æ¥æ£€æµ‹å’Œæ¸…é™¤ä»»ä½•è¿‡æ—¶ çš„ Stateã€‚</p> <h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="header-anchor">#</a> å‚è€ƒèµ„æ–™</h2> <ul><li><a href="https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/" target="_blank" rel="noopener noreferrer">Flink å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/bigdata-tutorial/edit/master/docs/flink/Flinkäº‹ä»¶é©±åŠ¨.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">4 days ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/bigdata-tutorial/assets/js/app.3ada26ba.js" defer></script><script src="/bigdata-tutorial/assets/js/4.cda5e0f1.js" defer></script><script src="/bigdata-tutorial/assets/js/14.a9835374.js" defer></script><script src="/bigdata-tutorial/assets/js/5.9d6e4fe2.js" defer></script>
  </body>
</html>
