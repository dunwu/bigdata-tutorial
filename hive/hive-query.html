<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hive 数据查询详解 | BIGDATA-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/bigdata-tutorial/favicon.ico">
    <meta name="description" content="大数据教程">
    
    <link rel="preload" href="/bigdata-tutorial/assets/css/0.styles.eecf7a64.css" as="style"><link rel="preload" href="/bigdata-tutorial/assets/js/app.3ada26ba.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/4.cda5e0f1.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/36.32bb3f84.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/5.9d6e4fe2.js" as="script"><link rel="prefetch" href="/bigdata-tutorial/assets/js/10.1ab7bd74.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/11.a42f7604.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/12.7dce2ed8.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/13.1b26207d.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/14.a9835374.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/15.90c66596.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/16.e0471453.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/17.2c0565cb.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/18.fabbce00.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/19.c120a108.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/20.5a4f48af.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/21.d3fce730.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/22.00ac574a.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/23.754595c9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/24.fc9d31a1.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/25.d4313bcb.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/26.604f045b.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/27.22a239b2.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/28.466b9a71.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/29.2783ebfd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/30.2ff3250e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/31.2c64e404.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/32.0ab8b31c.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/33.be38d2dc.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/34.811f6626.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/35.9d9f3847.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/37.db182f29.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/38.91a9d6f3.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/39.1148f971.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/40.1536c75c.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/41.31725066.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/42.68e59bdd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/43.9bac72d5.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/44.a2edd3e0.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/45.4a1cf2ae.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/46.d8a80a79.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/47.9621b1a5.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/48.56d4fa14.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/49.d9d143dd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/50.6e4aa6cd.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/51.55771fda.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/52.ee51188b.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/53.b014e486.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/54.ae66c176.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/55.2ea9bfd9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/56.ffb4a04b.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/57.bdee2f7e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/58.982c2219.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/59.c006237e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/6.3bb0b816.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/60.b27dc3c8.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/7.d55602d2.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/8.89e9ace9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/9.0c40eb95.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/vendors~flowchart.5998caa6.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/vendors~notification.943e54fe.js">
    <link rel="stylesheet" href="/bigdata-tutorial/assets/css/0.styles.eecf7a64.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bigdata-tutorial/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo-200.png" alt="BIGDATA-TUTORIAL" class="logo"> <span class="site-name can-hide">BIGDATA-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bigdata-tutorial/hive/" class="nav-link router-link-active">
  Hive
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hdfs/" class="nav-link">
  Hdfs
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hbase/" class="nav-link">
  Hbase
</a></div><div class="nav-item"><a href="/bigdata-tutorial/zookeeper/" class="nav-link">
  ZooKeeper
</a></div><div class="nav-item"><a href="/bigdata-tutorial/kafka/" class="nav-link">
  Kafka
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">✨ Java系列</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">✨ Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/bigdata-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bigdata-tutorial/hive/" class="nav-link router-link-active">
  Hive
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hdfs/" class="nav-link">
  Hdfs
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hbase/" class="nav-link">
  Hbase
</a></div><div class="nav-item"><a href="/bigdata-tutorial/zookeeper/" class="nav-link">
  ZooKeeper
</a></div><div class="nav-item"><a href="/bigdata-tutorial/kafka/" class="nav-link">
  Kafka
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">✨ Java系列</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">✨ Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot 教程 📚
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/bigdata-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Hive 数据查询详解</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bigdata-tutorial/hive/hive-query.html#一、数据准备" class="sidebar-link">一、数据准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_1-1-员工表" class="sidebar-link">1.1 员工表</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_1-2-部门表" class="sidebar-link">1.2 部门表</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_1-3-分区表" class="sidebar-link">1.3 分区表</a></li></ul></li><li><a href="/bigdata-tutorial/hive/hive-query.html#二、单表查询" class="sidebar-link">二、单表查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-1-select" class="sidebar-link">2.1 SELECT</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-2-where" class="sidebar-link">2.2 WHERE</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-3-distinct" class="sidebar-link">2.3 DISTINCT</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-4-分区查询" class="sidebar-link">2.4 分区查询</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-5-limit" class="sidebar-link">2.5 LIMIT</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-6-group-by" class="sidebar-link">2.6 GROUP BY</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-7-order-and-sort" class="sidebar-link">2.7 ORDER AND SORT</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-8-having" class="sidebar-link">2.8 HAVING</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-9-distribute-by" class="sidebar-link">2.9 DISTRIBUTE BY</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_2-10-cluster-by" class="sidebar-link">2.10 CLUSTER BY</a></li></ul></li><li><a href="/bigdata-tutorial/hive/hive-query.html#三、多表联结查询" class="sidebar-link">三、多表联结查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_3-1-inner-join" class="sidebar-link">3.1 INNER JOIN</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_3-2-left-outer-join" class="sidebar-link">3.2 LEFT OUTER JOIN</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_3-3-right-outer-join" class="sidebar-link">3.3 RIGHT OUTER JOIN</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_3-4-full-outer-join" class="sidebar-link">3.4 FULL OUTER JOIN</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_3-5-left-semi-join" class="sidebar-link">3.5 LEFT SEMI JOIN</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_3-6-join" class="sidebar-link">3.6 JOIN</a></li></ul></li><li><a href="/bigdata-tutorial/hive/hive-query.html#四、join-优化" class="sidebar-link">四、JOIN 优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_4-1-streamtable" class="sidebar-link">4.1 STREAMTABLE</a></li><li class="sidebar-sub-header"><a href="/bigdata-tutorial/hive/hive-query.html#_4-2-mapjoin" class="sidebar-link">4.2 MAPJOIN</a></li></ul></li><li><a href="/bigdata-tutorial/hive/hive-query.html#五、select-的其他用途" class="sidebar-link">五、SELECT 的其他用途</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/hive/hive-query.html#六、本地模式" class="sidebar-link">六、本地模式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/hive/hive-query.html#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hive-数据查询详解"><a href="#hive-数据查询详解" class="header-anchor">#</a> Hive 数据查询详解</h1> <h2 id="一、数据准备"><a href="#一、数据准备" class="header-anchor">#</a> 一、数据准备</h2> <p>为了演示查询操作，这里需要预先创建三张表，并加载测试数据。</p> <blockquote><p>数据文件 emp.txt 和 dept.txt 可以从本仓库的<a href="https://github.com/heibaiying/BigData-Notes/tree/master/resources" target="_blank" rel="noopener noreferrer">resources<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 目录下载。</p></blockquote> <h3 id="_1-1-员工表"><a href="#_1-1-员工表" class="header-anchor">#</a> 1.1 员工表</h3> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token comment">-- 建表语句</span>
 <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp<span class="token punctuation">(</span>
     empno <span class="token keyword">INT</span><span class="token punctuation">,</span>     <span class="token comment">-- 员工表编号</span>
     ename STRING<span class="token punctuation">,</span>  <span class="token comment">-- 员工姓名</span>
     job STRING<span class="token punctuation">,</span>    <span class="token comment">-- 职位类型</span>
     mgr <span class="token keyword">INT</span><span class="token punctuation">,</span>
     hiredate <span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span>  <span class="token comment">--雇佣日期</span>
     sal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">--工资</span>
     comm <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     deptno <span class="token keyword">INT</span><span class="token punctuation">)</span>   <span class="token comment">--部门编号</span>
    <span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">&quot;\t&quot;</span><span class="token punctuation">;</span>

  <span class="token comment">--加载数据</span>
<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> INPATH <span class="token string">&quot;/usr/file/emp.txt&quot;</span> OVERWRITE <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> emp<span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-部门表"><a href="#_1-2-部门表" class="header-anchor">#</a> 1.2 部门表</h3> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token comment">-- 建表语句</span>
 <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dept<span class="token punctuation">(</span>
     deptno <span class="token keyword">INT</span><span class="token punctuation">,</span>   <span class="token comment">--部门编号</span>
     dname STRING<span class="token punctuation">,</span>  <span class="token comment">--部门名称</span>
     loc STRING    <span class="token comment">--部门所在的城市</span>
 <span class="token punctuation">)</span>
 <span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">&quot;\t&quot;</span><span class="token punctuation">;</span>

 <span class="token comment">--加载数据</span>
 <span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> INPATH <span class="token string">&quot;/usr/file/dept.txt&quot;</span> OVERWRITE <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> dept<span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-3-分区表"><a href="#_1-3-分区表" class="header-anchor">#</a> 1.3 分区表</h3> <p>这里需要额外创建一张分区表，主要是为了演示分区查询：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> emp_ptn<span class="token punctuation">(</span>
      empno <span class="token keyword">INT</span><span class="token punctuation">,</span>
      ename STRING<span class="token punctuation">,</span>
      job STRING<span class="token punctuation">,</span>
      mgr <span class="token keyword">INT</span><span class="token punctuation">,</span>
      hiredate <span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span>
      sal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      comm <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
 PARTITIONED <span class="token keyword">BY</span> <span class="token punctuation">(</span>deptno <span class="token keyword">INT</span><span class="token punctuation">)</span>   <span class="token comment">-- 按照部门编号进行分区</span>
 <span class="token keyword">ROW</span> FORMAT DELIMITED <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">&quot;\t&quot;</span><span class="token punctuation">;</span>


<span class="token comment">--加载数据</span>
<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> INPATH <span class="token string">&quot;/usr/file/emp.txt&quot;</span> OVERWRITE <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> emp_ptn <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>deptno<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> INPATH <span class="token string">&quot;/usr/file/emp.txt&quot;</span> OVERWRITE <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> emp_ptn <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>deptno<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> INPATH <span class="token string">&quot;/usr/file/emp.txt&quot;</span> OVERWRITE <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> emp_ptn <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>deptno<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>
<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">LOCAL</span> INPATH <span class="token string">&quot;/usr/file/emp.txt&quot;</span> OVERWRITE <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> emp_ptn <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>deptno<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="二、单表查询"><a href="#二、单表查询" class="header-anchor">#</a> 二、单表查询</h2> <h3 id="_2-1-select"><a href="#_2-1-select" class="header-anchor">#</a> 2.1 SELECT</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询表中全部数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-2-where"><a href="#_2-2-where" class="header-anchor">#</a> 2.2 WHERE</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询 10 号部门中员工编号大于 7782 的员工信息</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> empno <span class="token operator">&gt;</span> <span class="token number">7782</span> <span class="token operator">AND</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-3-distinct"><a href="#_2-3-distinct" class="header-anchor">#</a> 2.3 DISTINCT</h3> <p>Hive 支持使用 DISTINCT 关键字去重。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询所有工作类型</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> job <span class="token keyword">FROM</span> emp<span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-4-分区查询"><a href="#_2-4-分区查询" class="header-anchor">#</a> 2.4 分区查询</h3> <p>分区查询 (Partition Based Queries)，可以指定某个分区或者分区范围。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询分区表中部门编号在[20,40]之间的员工</span>
<span class="token keyword">SELECT</span> emp_ptn<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> emp_ptn
<span class="token keyword">WHERE</span> emp_ptn<span class="token punctuation">.</span>deptno <span class="token operator">&gt;=</span> <span class="token number">20</span> <span class="token operator">AND</span> emp_ptn<span class="token punctuation">.</span>deptno <span class="token operator">&lt;=</span> <span class="token number">40</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-5-limit"><a href="#_2-5-limit" class="header-anchor">#</a> 2.5 LIMIT</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询薪资最高的 5 名员工</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sal <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-6-group-by"><a href="#_2-6-group-by" class="header-anchor">#</a> 2.6 GROUP BY</h3> <p>Hive 支持使用 GROUP BY 进行分组聚合操作。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> hive<span class="token punctuation">.</span>map<span class="token punctuation">.</span>aggr<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询各个部门薪酬综合</span>
<span class="token keyword">SELECT</span> deptno<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> deptno<span class="token punctuation">;</span>
</code></pre></div><p><code>hive.map.aggr</code> 控制程序如何进行聚合。默认值为 false。如果设置为 true，Hive 会在 map 阶段就执行一次聚合。这可以提高聚合效率，但需要消耗更多内存。</p> <h3 id="_2-7-order-and-sort"><a href="#_2-7-order-and-sort" class="header-anchor">#</a> 2.7 ORDER AND SORT</h3> <p>可以使用 ORDER BY 或者 Sort BY 对查询结果进行排序，排序字段可以是整型也可以是字符串：如果是整型，则按照大小排序；如果是字符串，则按照字典序排序。ORDER BY 和 SORT BY 的区别如下：</p> <ul><li>使用 ORDER BY 时会有一个 Reducer 对全部查询结果进行排序，可以保证数据的全局有序性；</li> <li>使用 SORT BY 时只会在每个 Reducer 中进行排序，这可以保证每个 Reducer 的输出数据是有序的，但不能保证全局有序。</li></ul> <p>由于 ORDER BY 的时间可能很长，如果你设置了严格模式 (hive.mapred.mode = strict)，则其后面必须再跟一个 <code>limit</code> 子句。</p> <blockquote><p>注 ：hive.mapred.mode 默认值是 nonstrict ，也就是非严格模式。</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询员工工资，结果按照部门升序，按照工资降序排列</span>
<span class="token keyword">SELECT</span> empno<span class="token punctuation">,</span> deptno<span class="token punctuation">,</span> sal <span class="token keyword">FROM</span> emp <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> deptno <span class="token keyword">ASC</span><span class="token punctuation">,</span> sal <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-8-having"><a href="#_2-8-having" class="header-anchor">#</a> 2.8 HAVING</h3> <p>可以使用 HAVING 对分组数据进行过滤。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询工资总和大于 9000 的所有部门</span>
<span class="token keyword">SELECT</span> deptno<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> deptno <span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">9000</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-9-distribute-by"><a href="#_2-9-distribute-by" class="header-anchor">#</a> 2.9 DISTRIBUTE BY</h3> <p>默认情况下，MapReduce 程序会对 Map 输出结果的 Key 值进行散列，并均匀分发到所有 Reducer 上。如果想要把具有相同 Key 值的数据分发到同一个 Reducer 进行处理，这就需要使用 DISTRIBUTE BY 字句。</p> <p>需要注意的是，DISTRIBUTE BY 虽然能保证具有相同 Key 值的数据分发到同一个 Reducer，但是不能保证数据在 Reducer 上是有序的。情况如下：</p> <p>把以下 5 个数据发送到两个 Reducer 上进行处理：</p> <div class="language-properties extra-class"><pre class="language-properties"><code>k1
k2
k4
k3
k1
</code></pre></div><p>Reducer1 得到如下乱序数据：</p> <div class="language-properties extra-class"><pre class="language-properties"><code>k1
k2
k1
</code></pre></div><p>Reducer2 得到数据如下：</p> <div class="language-properties extra-class"><pre class="language-properties"><code>k4
k3
</code></pre></div><p>如果想让 Reducer 上的数据时有序的，可以结合 <code>SORT BY</code> 使用 (示例如下)，或者使用下面我们将要介绍的 CLUSTER BY。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 将数据按照部门分发到对应的 Reducer 上处理</span>
<span class="token keyword">SELECT</span> empno<span class="token punctuation">,</span> deptno<span class="token punctuation">,</span> sal <span class="token keyword">FROM</span> emp DISTRIBUTE <span class="token keyword">BY</span> deptno SORT <span class="token keyword">BY</span> deptno <span class="token keyword">ASC</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-10-cluster-by"><a href="#_2-10-cluster-by" class="header-anchor">#</a> 2.10 CLUSTER BY</h3> <p>如果 <code>SORT BY</code> 和 <code>DISTRIBUTE BY</code> 指定的是相同字段，且 SORT BY 排序规则是 ASC，此时可以使用 <code>CLUSTER BY</code> 进行替换，同时 <code>CLUSTER BY</code> 可以保证数据在全局是有序的。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> empno<span class="token punctuation">,</span> deptno<span class="token punctuation">,</span> sal <span class="token keyword">FROM</span> emp CLUSTER  <span class="token keyword">BY</span> deptno <span class="token punctuation">;</span>
</code></pre></div><h2 id="三、多表联结查询"><a href="#三、多表联结查询" class="header-anchor">#</a> 三、多表联结查询</h2> <p>Hive 支持内连接，外连接，左外连接，右外连接，笛卡尔连接，这和传统数据库中的概念是一致的，可以参见下图。</p> <p>需要特别强调：JOIN 语句的关联条件必须用 ON 指定，不能用 WHERE 指定，否则就会先做笛卡尔积，再过滤，这会导致你得不到预期的结果 (下面的演示会有说明)。</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200224195733.png" alt="img"></p> <h3 id="_3-1-inner-join"><a href="#_3-1-inner-join" class="header-anchor">#</a> 3.1 INNER JOIN</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询员工编号为 7369 的员工的详细信息</span>
<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span>
emp e <span class="token keyword">JOIN</span> dept d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno
<span class="token keyword">WHERE</span> empno<span class="token operator">=</span><span class="token number">7369</span><span class="token punctuation">;</span>

<span class="token comment">--如果是三表或者更多表连接，语法如下</span>
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>val<span class="token punctuation">,</span> b<span class="token punctuation">.</span>val<span class="token punctuation">,</span> c<span class="token punctuation">.</span>val <span class="token keyword">FROM</span> a <span class="token keyword">JOIN</span> b <span class="token keyword">ON</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token keyword">key</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>key1<span class="token punctuation">)</span> <span class="token keyword">JOIN</span> c <span class="token keyword">ON</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token keyword">key</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>key1<span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-2-left-outer-join"><a href="#_3-2-left-outer-join" class="header-anchor">#</a> 3.2 LEFT OUTER JOIN</h3> <p>LEFT OUTER JOIN 和 LEFT JOIN 是等价的。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 左连接</span>
<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> emp e <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span>  <span class="token keyword">JOIN</span>  dept d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-3-right-outer-join"><a href="#_3-3-right-outer-join" class="header-anchor">#</a> 3.3 RIGHT OUTER JOIN</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--右连接</span>
<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> emp e <span class="token keyword">RIGHT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span>  dept d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
</code></pre></div><p>执行右连接后，由于 40 号部门下没有任何员工，所以此时员工信息为 NULL。这个查询可以很好的复述上面提到的——JOIN 语句的关联条件必须用 ON 指定，不能用 WHERE 指定。你可以把 ON 改成 WHERE，你会发现无论如何都查不出 40 号部门这条数据，因为笛卡尔运算不会有 (NULL, 40) 这种情况。</p> <p><img src="https://github.com/heibaiying/BigData-Notes/raw/master/pictures/hive-right-join.png" alt="img"></p> <h3 id="_3-4-full-outer-join"><a href="#_3-4-full-outer-join" class="header-anchor">#</a> 3.4 FULL OUTER JOIN</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> emp e <span class="token keyword">FULL</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span>  dept d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-5-left-semi-join"><a href="#_3-5-left-semi-join" class="header-anchor">#</a> 3.5 LEFT SEMI JOIN</h3> <p>LEFT SEMI JOIN （左半连接）是 IN/EXISTS 子查询的一种更高效的实现。</p> <ul><li>JOIN 子句中右边的表只能在 ON 子句中设置过滤条件;</li> <li>查询结果只包含左边表的数据，所以只能 SELECT 左表中的列。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询在纽约办公的所有员工信息</span>
<span class="token keyword">SELECT</span> emp<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> emp <span class="token keyword">LEFT</span> SEMI <span class="token keyword">JOIN</span> dept
<span class="token keyword">ON</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">AND</span> dept<span class="token punctuation">.</span>loc<span class="token operator">=</span><span class="token string">&quot;NEW YORK&quot;</span><span class="token punctuation">;</span>

<span class="token comment">--上面的语句就等价于</span>
<span class="token keyword">SELECT</span> emp<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> emp
<span class="token keyword">WHERE</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> deptno <span class="token keyword">FROM</span> dept <span class="token keyword">WHERE</span> loc<span class="token operator">=</span><span class="token string">&quot;NEW YORK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-6-join"><a href="#_3-6-join" class="header-anchor">#</a> 3.6 JOIN</h3> <p>笛卡尔积连接，这个连接日常的开发中可能很少遇到，且性能消耗比较大，基于这个原因，如果在严格模式下 (hive.mapred.mode = strict)，Hive 会阻止用户执行此操作。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp <span class="token keyword">JOIN</span> dept<span class="token punctuation">;</span>
</code></pre></div><h2 id="四、join-优化"><a href="#四、join-优化" class="header-anchor">#</a> 四、JOIN 优化</h2> <h3 id="_4-1-streamtable"><a href="#_4-1-streamtable" class="header-anchor">#</a> 4.1 STREAMTABLE</h3> <p>在多表进行联结的时候，如果每个 ON 字句都使用到共同的列（如下面的 <code>b.key</code>），此时 Hive 会进行优化，将多表 JOIN 在同一个 map / reduce 作业上进行。同时假定查询的最后一个表（如下面的 c 表）是最大的一个表，在对每行记录进行 JOIN 操作时，它将尝试将其他的表缓存起来，然后扫描最后那个表进行计算。因此用户需要保证查询的表的大小从左到右是依次增加的。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token identifier"><span class="token punctuation">`</span>SELECT a.val, b.val, c.val FROM a JOIN b ON (a.key = b.key) JOIN c ON (c.key = b.key)<span class="token punctuation">`</span></span>
</code></pre></div><p>然后，用户并非需要总是把最大的表放在查询语句的最后面，Hive 提供了 <code>/*+ STREAMTABLE() */</code> 标志，用于标识最大的表，示例如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token comment">/*+ STREAMTABLE(d) */</span>  e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> emp e <span class="token keyword">JOIN</span> dept d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno
<span class="token keyword">WHERE</span> job<span class="token operator">=</span><span class="token string">'CLERK'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-2-mapjoin"><a href="#_4-2-mapjoin" class="header-anchor">#</a> 4.2 MAPJOIN</h3> <p>如果所有表中只有一张表是小表，那么 Hive 把这张小表加载到内存中。这时候程序会在 map 阶段直接拿另外一个表的数据和内存中表数据做匹配，由于在 map 就进行了 JOIN 操作，从而可以省略 reduce 过程，这样效率可以提升很多。Hive 中提供了 <code>/*+ MAPJOIN() */</code> 来标记小表，示例如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token comment">/*+ MAPJOIN(d) */</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> emp e <span class="token keyword">JOIN</span> dept d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno
<span class="token keyword">WHERE</span> job<span class="token operator">=</span><span class="token string">'CLERK'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="五、select-的其他用途"><a href="#五、select-的其他用途" class="header-anchor">#</a> 五、SELECT 的其他用途</h2> <p>查看当前数据库：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> current_database<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="六、本地模式"><a href="#六、本地模式" class="header-anchor">#</a> 六、本地模式</h2> <p>在上面演示的语句中，大多数都会触发 MapReduce, 少部分不会触发，比如 <code>select * from emp limit 5</code> 就不会触发 MR，此时 Hive 只是简单的读取数据文件中的内容，然后格式化后进行输出。在需要执行 MapReduce 的查询中，你会发现执行时间可能会很长，这时候你可以选择开启本地模式。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--本地模式默认关闭，需要手动开启此功能</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token punctuation">.</span><span class="token keyword">local</span><span class="token punctuation">.</span>auto<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p>启用后，Hive 将分析查询中每个 map-reduce 作业的大小，如果满足以下条件，则可以在本地运行它：</p> <ul><li>作业的总输入大小低于：hive.exec.mode.local.auto.inputbytes.max（默认为 128MB）；</li> <li>map-tasks 的总数小于：hive.exec.mode.local.auto.tasks.max（默认为 4）；</li> <li>所需的 reduce 任务总数为 1 或 0。</li></ul> <p>因为我们测试的数据集很小，所以你再次去执行上面涉及 MR 操作的查询，你会发现速度会有显著的提升。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select" target="_blank" rel="noopener noreferrer">LanguageManual Select<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Joins" target="_blank" rel="noopener noreferrer">LanguageManual Joins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+GroupBy" target="_blank" rel="noopener noreferrer">LanguageManual GroupBy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+SortBy" target="_blank" rel="noopener noreferrer">LanguageManual SortBy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/bigdata-tutorial/edit/master/docs/hive/hive-query.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">9 months ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/bigdata-tutorial/assets/js/app.3ada26ba.js" defer></script><script src="/bigdata-tutorial/assets/js/4.cda5e0f1.js" defer></script><script src="/bigdata-tutorial/assets/js/36.32bb3f84.js" defer></script><script src="/bigdata-tutorial/assets/js/5.9d6e4fe2.js" defer></script>
  </body>
</html>
